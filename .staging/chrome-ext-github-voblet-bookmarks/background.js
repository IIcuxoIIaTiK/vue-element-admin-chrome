!function e(t,n,r){function o(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){var n=t[a][1][e];return o(n?n:e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,n){"use strict";function r(){var e=c.getDeviceId();e||(e=d.generateUUID(),c.setDeviceId(e)),l.setup(),f.setup(),p.activateListener(),c.getAuthToken()?(g.refreshTokenIfRequired(),g.createContextMenus(),g.syncDeviceList(function(e){e&&g.createContextMenus()}),f.updateViewedCount()):g.handleUnauthorizedRequest()}function o(e){d.gaEvent(v,"onInstalled"),l.setup(),f.setup();var t=c.getDeviceId();d.injectContentScript(),t||(c.emptyLocalStorage(),c.setDefaults(),t=chrome.runtime.id,c.setDeviceId(t)),c.setGithubFeatureDefaults(),c.setDefaults(),c.getGcmToken()?a():u()}function i(){l.setup(),f.setup(),a(),d.gaEvent(v,"onStartup")}function a(){g.refreshTokenIfRequired(),c.getAuthToken()?(g.createContextMenus(),g.syncDeviceList(function(e){e&&g.createContextMenus()}),f.updateViewedCount()):g.handleUnauthorizedRequest()}function s(){p.activateListener(),m.activateGCMListener(),g.activateCommandListener()}function u(){var e=[h.GoogleProjectNumber];chrome.gcm.register(e,function(e){return chrome.runtime.lastError?(c.setItem(h.GCMErrorKey,chrome.runtime.lastError),void d.gaEvent(v,"chromeGCMRegistrationError",chrome.runtime.lastError)):(c.setGcmToken(e),void g.getAuthTokenAndLogin())})}var c=e("./lib/db.js"),l=e("./lib/bookmarksDb.js"),f=e("./lib/queueDb.js"),h=e("./lib/constants.js"),d=e("./lib/util.js"),m=e("./lib/notify.js"),g=e("./lib/api.js"),p=e("./lib/message.js"),v="background";d.getBrowser()==h.Firefox?r():(chrome.runtime.onInstalled.addListener(function(e){o(e)}),s(),chrome.runtime.onStartup.addListener(function(){i()}),chrome.management.onEnabled.addListener(function(e){i(),d.injectContentScript()}))},{"./lib/api.js":2,"./lib/bookmarksDb.js":3,"./lib/constants.js":4,"./lib/db.js":5,"./lib/message.js":6,"./lib/notify.js":7,"./lib/queueDb.js":8,"./lib/util.js":9}],2:[function(e,t,n){"use strict";function r(){var e=m.getDeviceName();if(!e)return I(),void chrome.tabs.create({active:!0,url:g.LoginPageUrl});var t=A();t.success(function(e){m.setAuthToken(e.authToken),m.setDirectedId(e.directedId),m.isDefaultsSet()||m.setDefaults(),chrome.browserAction.setPopup({popup:"html/main.html"}),D(function(e){e&&L()}),E(),L(),a(),p.setBadgeText(0),y.updateViewedCount(),p.gaEvent(w,"getAuthTokenAndLoginSuccess")}),t.fail(function(e,t,n){I(),p.gaEvent(w,"getAuthTokenAndLoginFail")})}function o(e,t,n){"complete"==t.status&&n.url.indexOf(g.HomePageUrl)>-1&&(r(),chrome.tabs.remove(n.id,function(){}))}function i(){chrome.tabs.onUpdated.addListener(o)}function a(){chrome.tabs.onUpdated.removeListener(o)}function s(e,t){var n=e.menuItemId.split(";")[0],r=e.menuItemId.split(";")[1],o=e.pageUrl,i=t.title,a=t.favIconUrl,s="";chrome.tabs.query({currentWindow:!0,active:!0},function(e){chrome.tabs.sendMessage(e[0].id,{name:g.MessageGetUrlImage},function(e){s=e})}),setTimeout(j(n,null,o,i,s,a,r),250)}function u(e,t){var n=e.menuItemId.split(";")[1],r=e.menuItemId.split(";")[2],o=e.linkUrl,i="",a="",s="";j(n,null,o,i,s,a,r)}function c(e,t){var n=e.pageUrl,r=t.title,o=t.favIconUrl,i="";chrome.tabs.query({currentWindow:!0,active:!0},function(e){chrome.tabs.sendMessage(e[0].id,{name:g.MessageGetUrlImage},function(e){i=e})}),setTimeout(B(null,n,r,i,o),350)}function l(e,t){var n=e.linkUrl,r="",o="",i="";B(null,n,r,i,o)}function f(e,t){if(m.getBoolean(g.ShowBookmarkTagsDialog))p.showAddTagsDialog(m.getBookmarkTags());else{var n=e.pageUrl,r=t.title,o=t.favIconUrl,i="";chrome.tabs.query({currentWindow:!0,active:!0},function(e){chrome.tabs.sendMessage(t[0].id,{name:g.MessageGetUrlImage},function(e){i=e})}),setTimeout(U(null,n,r,i,o),350)}}function h(e,t){var n=e.linkUrl,r="",o="",i="";U(null,n,r,i,o)}function d(){chrome.tabs.create({url:chrome.extension.getURL("html/settings.html"),active:!0}),p.gaEvent(x,"showSettingsPage")}var m=e("./db.js"),g=e("./constants.js"),p=e("./util.js"),v=e("./notify.js"),y=e("./queueDb.js"),b=e("./bookmarksDb.js"),k=e("jwt-decode"),w="api",x="contexMenu",T=function(e,t,n){return $.ajax({url:e,type:t,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+localStorage.getItem(g.AuthTokenKey))},data:n,complete:function(t,n){401==t.status?I():e!=g.RefreshTokenApi&&M()}})},I=function(){var e=window.location.href;e&&e.indexOf("_generated_background_page.html")>-1?(i(),v.showLoginNotification()):e&&e.indexOf("github.html")>-1?p.sendMessage({name:g.MessageActivateTabListener}):(window.location.href=g.LoginPageUrl,p.sendMessage({name:g.MessageActivateTabListener})),chrome.browserAction.setPopup({popup:"/html/login.html"}),chrome.contextMenus.removeAll(),chrome.contextMenus.create({id:"1",title:"Click on Voblet icon in menu to Login",contexts:["all"]})},_=function(){C(),m.setAuthToken(""),m.setQueueLastUpdatedTimestamp(0),m.setBookmarksLastUpdatedTimestamp(0),m.updateDevicesList([]),p.setBadgeText(":("),y.deleteAll().then(function(e){}).catch(function(e){}),b.deleteAll().then(function(e){}).catch(function(e){}),I(),p.gaEvent(w,"logoutUser")},S=function(e,t){return $.ajax({url:e,type:"POST",dataType:"json",contentType:"application/json; charset=UTF-8",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+m.getAuthToken())},data:JSON.stringify(t),complete:function(e,t){401==e.status?I():M()}})},A=function(){var e=m.getDeviceName();return e||(e="chrome",m.setDeviceName(e)),$.ajax({type:"POST",url:g.ChromeLoginUrl,data:{deviceId:m.getDeviceId(),pushToken:m.getGcmToken(),deviceName:e}})},M=function(){var e=m.getAuthToken();try{var t=k(e),n=Date.now()/1e3;if(t.exp-n<g.FifteenDays){var r=T(g.RefreshTokenApi,"POST",{});r.success(function(e){m.setAuthToken(e.authToken),p.gaEvent(w,"refreshTokenIfRequiredSuccess")}),r.fail(function(e,t,n){p.gaEvent(w,"refreshTokenIfRequiredFail")})}}catch(e){}},D=function(e){var t=T(g.DevicesApi,"GET",{});t.success(function(t){m.updateDevicesList(t.devices),e(g.Success),p.gaEvent(w,"syncDeviceListSuccess")}),t.fail(function(t,n,r){e(g.Fail),p.gaEvent(w,"syncDeviceListFail",t.status)})},C=function(){var e=S(g.DevicesApi+"/"+m.getDeviceId(),{action:g.ActionLogout});e.success(function(e){p.gaEvent(w,"logoutDeviceOnServerSideSuccess")}),e.fail(function(e,t,n){p.gaEvent(w,"logoutDeviceOnServerSideFail",e.status)})},E=function(e){var t=T(g.TagsApi,"GET",{});t.success(function(t){m.updateBookmarkTags(t.tags),e&&e(g.Success),p.gaEvent(w,"syncBookmarkTagsSucces")}),t.fail(function(t,n,r){e&&e(g.Fail),p.gaEvent(w,"syncBookmarkTagsFail",t.status)})},B=function(e,t,n,r,o){var i={note:e,url:t,urlTitle:n,urImage:r,urlIcon:o},a=S(g.QueueApi,i);a.success(function(e){p.showToastInTab(g.QueueSuccessMessage),y.addItem(e).then(function(e){y.updateViewedCount()}).catch(function(e){}),p.gaEvent(x,"addToQueueSuccess")}),a.fail(function(e,t,n){p.showToastInTab(g.QueueFailedMessage),p.gaEvent(x,"addToQueueFail",e.status)})},j=function(e,t,n,r,o,i,a){var s={type:g.TypeUrl,note:t,content:n,urlTitle:r,urImage:o,urlIcon:i,destination:e,action:a},u=S(g.SharedApi,s);u.success(function(e){p.showToastInTab(g.SharedSuccessMessage),m.addToShared(e),p.gaEvent(x,"addToSharedSuccess")}),u.fail(function(e,t,n){p.showToastInTab(g.SharedFailedMessage),p.gaEvent(x,"addToSharedFail",e.status)})},U=function(e,t,n,r,o){var i={note:e,url:t,tagIds:[],urlTitle:n,urImage:r,urlIcon:o},a=S(g.BookmarkApi,i);a.success(function(e){p.showToastInTab(g.BookmarkSuccessMessage),b.addItem(e.bookmarkItem).then(function(e){}).catch(function(e){}),p.gaEvent(x,"saveBookmarkSuccess")}),a.fail(function(e,t,n){p.showToastInTab(g.BookmarkFailedMessage),p.gaEvent(x,"saveBookmarkFail",e.status)})},O=function(){chrome.commands.onCommand.addListener(function(e){"add-to-bookmarks"==e?chrome.tabs.query({active:!0,lastFocusedWindow:!0},function(e){if(m.getBoolean(g.ShowBookmarkTagsDialog))p.showAddTagsDialog(m.getBookmarkTags());else{var t="";chrome.tabs.getSelected(null,function(e){chrome.tabs.sendMessage(e.id,{name:g.MessageGetUrlImage},function(e){t=e})}),setTimeout(U(null,e[0].url,e[0].title,t,e[0].favIconUrl),250)}}):"add-to-queue"==e&&chrome.tabs.query({active:!0,lastFocusedWindow:!0},function(e){var t="";chrome.tabs.getSelected(null,function(e){chrome.tabs.sendMessage(e.id,{name:g.MessageGetUrlImage},function(e){t=e})}),setTimeout(B("",e[0].url,e[0].title,t,e[0].favIconUrl),250)}),p.gaEvent(w,"onCommand",e)})},L=function(){chrome.contextMenus.removeAll(function(){m.getBoolean(g.ShowContextMenuQueue)&&(chrome.contextMenus.create({id:"queue",title:"Add to Queue",contexts:["page"],onclick:c}),chrome.contextMenus.create({id:"queue;link",title:"Add to Queue",contexts:["link"],onclick:l})),m.getBoolean(g.ShowContextMenuBookmarks)&&(chrome.contextMenus.create({id:"bookmark",title:"Save as bookmark",contexts:["page"],onclick:f}),chrome.contextMenus.create({id:"bookmark;link",title:"Save as bookmark",contexts:["link"],onclick:h}));var e=m.getOtherDevicesList();e.length>1;for(var t=m.getBlockedDeviceIds(),n=0;n<e.length;n++)if(!(t.indexOf(e[n].itemId)>-1)){var r=e[n].type;chrome.contextMenus.create({id:e[n].itemId+";",title:"Send link to "+e[n].name,contexts:["page"],onclick:s}),chrome.contextMenus.create({id:"link;"+e[n].itemId+";",title:"Send link to "+e[n].name,contexts:["link"],onclick:u}),r==g.AndroidDeviceType&&(m.getBoolean(g.ShowContextMenuSendToWhatsapp)&&chrome.contextMenus.create({id:e[n].itemId+";"+g.ActionWhatsapp,title:"Send link to Whatsapp on "+e[n].name,contexts:["page"],onclick:s}),m.getBoolean(g.ShowContextMenuOpenOnPhone)&&chrome.contextMenus.create({id:e[n].itemId+";"+g.ActionOpenUrl,title:"Open link on "+e[n].name,contexts:["page"],onclick:s}))}chrome.contextMenus.create({id:"settings",title:"Settings",contexts:["all"],onclick:d},function(){}),p.gaEvent(x,"createContextMenus")})};t.exports={syncDeviceList:D,getRequestObj:T,getJsonPostRequestObj:S,getLoginRequestObj:A,getAuthTokenAndLogin:r,syncBookmarkTags:E,activateCommandListener:O,refreshTokenIfRequired:M,activateTabListener:i,createContextMenus:L,logoutUser:_,handleUnauthorizedRequest:I}},{"./bookmarksDb.js":3,"./constants.js":4,"./db.js":5,"./notify.js":7,"./queueDb.js":8,"./util.js":9,"jwt-decode":13}],3:[function(e,t,n){"use strict";function r(){try{y.version(1).stores({bookmarks:"itemId,url,created,updated"})}catch(e){}y.open().catch(function(e){})}function o(e,t){return e.searchText=l(e),new Promise(function(t,n){y.bookmarks.put(e).then(function(e){t(e),h()}).catch(function(e){n(e)})})}function i(e){return new Promise(function(t,n){y.bookmarks.delete(e).then(function(e){t(e),h()}).catch(function(e){n(e)})})}function a(e,t){y.transaction("rw",y.bookmarks,function(){for(var n=0;n<e.length;n++){var r=e[n];r.searchText=l(r),y.bookmarks.put(r).catch(function(e){m.setBookmarksLastUpdatedTimestamp(0),t(p.Fail,p.DatabaseErr,e)})}}).then(function(e){h(),t(p.Success)}).catch(function(e){m.setBookmarksLastUpdatedTimestamp(0),t(p.Fail,p.DatabaseErr,e),g.gaEvent(v,"bulkInsertFail")})}function s(e,t){y.transaction("rw",y.bookmarks,function(){for(var n=0;n<e.length;n++){var r=e[n];"D"!=r.updateAction?(r.searchText=l(r),y.bookmarks.put(r).catch(function(e){m.setBookmarksLastUpdatedTimestamp(0),t(p.Fail,p.DatabaseErr,e)})):y.bookmarks.delete(r.itemId).catch(function(e){m.setBookmarksLastUpdatedTimestamp(0),t(p.Fail,p.DatabaseErr,e)})}}).then(function(e){t(p.Success),h()}).catch(function(e){m.setBookmarksLastUpdatedTimestamp(0),t(p.Fail,p.DatabaseErr,e),g.gaEvent(v,"bulkInsertOnUpdateActionFail")})}function u(e){y.bookmarks.orderBy("created").reverse().toArray(function(t){e(p.Success,t)}).catch(function(t){e(p.Fail,p.DatabaseErr,t)})}function c(e){return y.bookmarks.where("url").startsWithAnyOfIgnoreCase(e)}function l(e){var t=e.note+b+e.url+b+e.urlTitle+b+e.urlImage;return t.toLowerCase()}function f(){return y.bookmarks.clear()}function h(){chrome.tabs&&chrome.tabs.query({url:["*://github.com/*","*://gist.github.com/*"]},function(e){for(var t=0;t<e.length;t++)chrome.tabs.sendMessage(e[t].id,{name:p.MessageBookmarksUpdated})})}var d=e("dexie"),m=e("./db.js"),g=e("./util.js"),p=e("./constants.js"),v="bookmarksDb",y=new d("Bookmarks"),b="fds{|}";t.exports={setup:r,bookmarkDb:y,addItem:o,deleteItem:i,getAll:u,getItemsWithUrlPrefix:c,deleteAll:f,bulkInsert:a,bulkInsertBasedOnUpdateAction:s}},{"./constants.js":4,"./db.js":5,"./util.js":9,dexie:10}],4:[function(e,t,n){"use strict";var r="https://api.voblet.com",o="https://voblet.com",i="Firefox",a="Chrome";t.exports=Object.freeze({GoogleProjectNumber:"594496440754",GoogleAnalyticsCode:"UA-86885186-3",SessionApi:r+"/v1/session",SharedApi:r+"/v1/shared",QueueApi:r+"/v1/queue",BookmarkApi:r+"/v1/bookmark",BookmarkBulkApi:r+"/v1/bookmarkbulk",DevicesApi:r+"/v1/devices",TagsApi:r+"/v1/tags",Firefox:i,Chrome:a,ChromeLoginUrl:o+"/chromelogin",WebsiteLoginPageUrl:o+"/login",HomePageUrl:o+"/home",RefreshTokenApi:o+"/refreshtoken",LoginPageUrl:chrome.extension.getURL("html/login.html"),SettingsPageUrl:chrome.extension.getURL("html/settings.html"),MainPageUrl:chrome.extension.getURL("html/main.html"),VobletPageUrl:chrome.extension.getURL("html/voblet.html"),MainTag:"main-tag",errorImage:"errorImage.png",AuthTokenKey:"authToken",Tendays:864e3,OneDay:86400,HalfDay:43200,FifteenDays:1296e3,Indefinite:36e5,FiveMinutesInMs:3e5,TenMinutesInMs:6e5,ListSelectedColor:"rgba(0, 0, 0, 0.2)",BodyColor:"#ededed",BlackColor:"#000",QueueResponseCount:200,BookmarkResponseCount:200,MaxSessionsLimit:20,UpdatedSinceCountPerRequest:200,SharedResponseCount:30,NoteMaxLength:200,BookmarkTagMaxLength:25,SessionNameMaxLength:50,TagsMaxCount:50,MaxUrlsInASession:40,ActionGetUpdatedSince:"get_updated_since",ActionGetAfter:"get_after",ActionMarkAsViewed:"mark_as_viewed",ActionMarkAsNotViewed:"mark_as_not_viewed",ActionLogout:"logout",RefreshContextMenu:"refreshContextMenu",LoginNotificationId:"loginNotification",ShowContextMenuDevices:"contextMenuDevices",ShowContextMenuQueue:"contextMenuQueue",ShowContextMenuBookmarks:"contextMenuBookmarks",ShowContextMenuSendToWhatsapp:"contextMenuSendToWhatsapp",ShowContextMenuOpenOnPhone:"contextMenuOpenOnPhone",ShowBookmarkTagsDialog:"showBookmarkTagsDialog",ShowBookmarksOptionsKey:"showBookmarksOptionsKey",GithubSavedCountKey:"githubSavedCount",DisplayNotificationsKey:"displayNotificationsKey",EnableGithubBookmarkingKey:"githubBookmarkingKey",EnableQueueGithubKey:"queueForGithub",QueueOpenNewTabKey:"queueOpenNewTabKey",SharedNotificationsKey:"sharedNotificationsKey",SharedOpenNewTabKey:"sharedOpenNewTabKey",BookmarksLastUpdateTimestamp:"bookmarksLastUpdateTimestamp",QueueLastUpdateTimestamp:"queueLastUpdateTimestamp",ShowMarkAsViewedKey:"showMarkAsViewed",DeleteAfterMoveToBookmarks:"deleteAfterMoveToBookmarks",GithubFirstTimeUserKey:"githubFirstTimeUserKey",ActionWhatsapp:"whatsapp",ActionOpenUrl:"openUrl",ActionFavoriteBookmark:"favorite",ActionUnfavoriteBookmark:"unfavorite",ActionUpdateTags:"update_tags",RecentFirst:"recentFirst",OldestFirst:"oldestFirst",ShowViewedItems:"showViewedItems",ShowQueue:"showQueue",BookmarkSuccessMessage:"Bookmark saved",BookmarkFailedMessage:"Failed to save Bookmark.Please try again.",QueueSuccessMessage:"Added to Queue",QueueFailedMessage:"Failed to add.Please try again.",SharedSuccessMessage:"Sent successfully",SharedFailedMessage:"Failed to send.Please try again.",RequestFailedMessage:"Request failed.Please try again.",ContentScriptYoutube:"contentScriptYoutube",ContentScriptGithub:"contentScriptGithub",TypeUrl:"url",TypeText:"text",AllDevices:"all",GCMTypeQueue:"queue",GCMTypeShared:"shared",GCMTypeTagsUpdate:"tags_update",GCMTypeDevicesUpdate:"devices_update",GCMTypeLogout:"logout",InvalidInputDataErr:"invalid_input_data",MissingRequiredFieldsErr:"missing_required_fields",MessageShowToast:"showToast",MessageShowAddTagsDialog:"messageShowAddTagsDialog",MessageCloseAddTagsDialog:"messageCloseAddTagsDialog",MessageGetOpenTabUrls:"getOpenTabUrls",MessageAddBookmark:"messageAddBookmark",MessageUpdateBookmark:"messageUpdateBookmark",MessageDeleteBookmark:"messageDeleteBookmark",MessageAddToQueue:"addToQueue",MessageDeleteFromQueue:"deleteFromQueue",ResponseOpenTabUrls:"responseOpenTabUrls",MessageActivateTabListener:"activateTabListener",MessageGetUrlImage:"getUrlImage",MessageGetQueueItem:"getQueueItem",MessageMarkAsViewed:"markAsViewed",MessageGetBookmarkTags:"getBookmarkTags",MessageGetGithubLinksInQueue:"getGithubLinksInQueue",MessageGetGithubLinksInBookmarks:"getGithubLinksInBookmarks",MessageGetValueLocalDb:"getValueLocalDb",MessageSetValueLocalDb:"setValueLocalDb",MessageBookmarksUpdated:"bookmarksUpdated",MessageQueueUpdated:"queueUpdated",MessageOpenUrlInRightNav:"openUrlInRightNav",MessageGAEvent:"gaEvent",GithubPrefix:"https://github.com",GithubGistPrefix:"https://gist.github.com",GetBookmarksAndTags:"GetBookmarksAndTags",SyncBookmarks:"SyncBookmarks",AndroidDeviceType:"android",Success:!0,Fail:!1,DatabaseErr:"databaseErr",NetworkErr:"networkErr",UnauthorizedErr:"unauthorizedErr",GCMErrorKey:"gcmErrorKey",TwitterIcon:"../img/twitter_icon.png",FacebookIcon:"../img/fb_icon.png",YoutubeIcon:"../img/youtube_icon.png"})},{}],5:[function(e,t,n){"use strict";function r(e){var t=localStorage.getItem(e);return null==t?[]:JSON.parse(t)}function o(e,t){localStorage.setItem(e,JSON.stringify(t))}var i=e("./constants.js"),a="gcmToken",s="deviceId",u="deviceName",c="deviceList",l="directedId",f="sessions",h="shared",d="blockedDevices",m="bookmarkTags",g="defaultsSet",p=function(e){return localStorage.getItem(e)},v=function(e,t){localStorage.setItem(e,t)},y=function(e){var t=localStorage.getItem(e);return"true"==t},b=function(e,t){localStorage.setItem(e,t)},k=function(){return localStorage.getItem(i.AuthTokenKey)},w=function(e){localStorage.setItem(i.AuthTokenKey,e)},x=function(){return localStorage.getItem(a)},T=function(e){localStorage.setItem(a,e),localStorage.setItem(i.GCMErrorKey,"")},I=function(){return localStorage.getItem(s)},_=function(e){localStorage.setItem(s,e)},S=function(){return localStorage.getItem(l)},A=function(e){localStorage.setItem(l,e)},M=function(){return localStorage.getItem(u)},D=function(e){localStorage.setItem(u,e)},C=function(){var e=Number(localStorage.getItem(i.BookmarksLastUpdateTimestamp));return isNaN(e)?0:e},E=function(e){localStorage.setItem(i.BookmarksLastUpdateTimestamp,e)},B=function(){var e=Number(localStorage.getItem(i.QueueLastUpdateTimestamp));return isNaN(e)?0:e},j=function(e){localStorage.setItem(i.QueueLastUpdateTimestamp,e)},U=function(){return r(c)},O=function(e){e?o(c,e):o(c,[])},L=function(){var e=r(c),t=localStorage.getItem(s),n=e.filter(function(e){return e.itemId!=t});return n},P=function(){return r(d)},F=function(e){var t=r(d);t.push(e),t=t.filter(function(e,t,n){return n.indexOf(e)==t}),o(d,t)},q=function(e){var t=r(d),n=t.indexOf(e);n>-1&&t.splice(n,1),o(d,t)},K=function(){ne()||(localStorage.setItem(i.DisplayNotificationsKey,!0),localStorage.setItem(i.ShowBookmarkTagsDialog,!0),localStorage.setItem(i.QueueNotificationsKey,!0),localStorage.setItem(i.SharedNotificationsKey,!0),localStorage.setItem(i.QueueOpenNewTabKey,!1),localStorage.setItem(i.SharedOpenNewTabKey,!0),localStorage.setItem(i.ShowMarkAsViewedKey,!0),localStorage.setItem(i.ShowContextMenuDevices,!0),localStorage.setItem(i.ShowContextMenuBookmarks,!0),localStorage.setItem(i.ShowContextMenuQueue,!0),localStorage.setItem(i.GithubFirstTimeUserKey,!0),localStorage.setItem(i.EnableGithubBookmarkingKey,!0),localStorage.setItem(g,!0))},N=function(){void 0==p(i.GithubFirstTimeUserKey)&&(v(i.GithubFirstTimeUserKey,!0),v(i.EnableGithubBookmarkingKey,!0))},G=function(){localStorage.clear()},R=function(){return r(f)},Q=function(e){for(var t=!1,n=r(f),i=0;i<n.length&&n[i].itemId!=e.itemId;i++);0==t&&(n.unshift(e),o(f,n))},V=function(e){e?o(f,e):o(f,[])},W=function(e){var t=r(f),n=t.filter(function(t){return t.itemId!=e});o(f,n)},z=function(){return r(h)},J=function(e){for(var t=r(h),n=0;n<t.length;n++)if(t[n].itemId==e)return t[n]},H=function(e){for(var t=!1,n=r(h),i=0;i<n.length&&n[i].itemId!=e.itemId;i++);0==t&&(n.unshift(e),o(h,n))},$=function(e){e?o(h,e):o(h,[])},Y=function(e){var t=r(h),n=t.filter(function(t){return t.itemId!=e});o(h,n)},X=function(){var e=r(m);return e.sort(function(e,t){var n=e.name.toLowerCase(),r=t.name.toLowerCase();return n<r?-1:n>r?1:0}),e},Z=function(e){var t=r(m),n=t.filter(function(t){return t.itemId!=e.itemId});n||(n=[]),n.unshift(e),o(m,n)},ee=function(e){e?o(m,e):o(m,[])},te=function(e){var t=r(m),n=t.filter(function(t){return t.itemId!=e});o(m,n)},ne=function(){return y(g)};t.exports={getItem:p,setItem:v,getBoolean:y,setBoolean:b,getAuthToken:k,setAuthToken:w,getGcmToken:x,setGcmToken:T,getDeviceId:I,setDeviceId:_,getDirectedId:S,setDirectedId:A,getDeviceName:M,setDeviceName:D,emptyLocalStorage:G,getDevicesList:U,getOtherDevicesList:L,updateDevicesList:O,setDefaults:K,isDefaultsSet:ne,getSessionsData:R,addToSessions:Q,updateSessionsData:V,deleteFromSessions:W,getSharedItem:J,getSharedData:z,addToShared:H,updateSharedData:$,deleteFromShared:Y,getBookmarksLastUpdatedTimestamp:C,setBookmarksLastUpdatedTimestamp:E,getQueueLastUpdatedTimestamp:B,setQueueLastUpdatedTimestamp:j,getBookmarkTags:X,addBookmakTag:Z,updateBookmarkTags:ee,deleteBookmarkTag:te,getBlockedDeviceIds:P,addBlockedDeviceIds:F,removeBlockedDeviceIds:q,setGithubFeatureDefaults:N}},{"./constants.js":4}],6:[function(e,t,n){"use strict";function r(e,t,n){if(e.name==i.MessageGetOpenTabUrls)o(),l.gaEvent(f,e.name);else if(e.name==i.RefreshContextMenu)a.createContextMenus(),l.gaEvent(f,e.name);else if(e.name==i.MessageAddBookmark){var r=a.getJsonPostRequestObj(i.BookmarkApi,e.data);r.success(function(e){if(u.addItem(e.bookmarkItem,function(){}),e.newTagItems)for(var t=0;t<e.newTagItems.length;t++)s.addBookmakTag(e.newTagItems[t]);n({status:i.Success,bookmarkItem:e.bookmarkItem,newTagItems:e.newTagItems})}),r.fail(function(e,t,r){n({status:i.Fail,statusCode:e.status})}),l.gaEvent(f,e.name)}else if(e.name==i.MessageUpdateBookmark){var r=a.getJsonPostRequestObj(i.BookmarkApi+"/"+e.itemId,e.data);r.success(function(e){if(u.addItem(e.bookmarkItem,function(){}),e.newTagItems)for(var t=0;t<e.newTagItems.length;t++)s.addBookmakTag(e.newTagItems[t]);n({status:i.Success,bookmarkItem:e.bookmarkItem,newTagItems:e.newTagItems})}),r.fail(function(e,t,r){n({status:i.Fail,statusCode:e.status})}),l.gaEvent(f,e.name)}else if(e.name==i.MessageDeleteBookmark){var h;!function(){var t=e.data.itemId;h=a.getRequestObj(i.BookmarkApi+"/"+t,"DELETE",{}),h.success(function(e){u.deleteItem(t).then(function(e){}).catch(function(e){}),n({status:i.Success}),l.gaEvent(f,"deleteBookmarkSuccess")}),h.fail(function(e,t,r){n({status:i.Fail,statusCode:e.status})}),l.gaEvent(f,e.name)}()}else if(e.name==i.MessageAddToQueue){var r=a.getJsonPostRequestObj(i.QueueApi,e.data);r.success(function(e){c.addItem(e).then(function(e){c.updateViewedCount()}).catch(function(e){}),n({status:i.Success,queueItem:e})}),r.fail(function(e,t,r){n({status:i.Fail,statusCode:e.status})}),l.gaEvent(f,e.name)}else if(e.name==i.MessageDeleteFromQueue){var h;!function(){var t=e.data.itemId;h=a.getRequestObj(i.QueueApi+"/"+t,"DELETE",{}),h.success(function(e){c.deleteItem(t).then(function(e){c.updateViewedCount()}).catch(function(e){}),n({status:i.Success}),l.gaEvent(f,"deleteQueueSuccess")}),h.fail(function(e,t,r){n({status:i.Fail,statusCode:e.status})}),l.gaEvent(f,e.name)}()}else if(e.name==i.MessageActivateTabListener)a.activateTabListener(),l.gaEvent(f,e.name);else if(e.name==i.MessageGetQueueItem)s.getAuthToken()&&s.getBoolean(i.ShowMarkAsViewedKey)?c.getItemByUrl(e.data.url).toArray(function(e){n(e.length>0?e[0]:void 0)}):n(void 0);else if(e.name==i.MessageMarkAsViewed){var d=e.data;if(d&&d.itemId){var m={action:i.ActionMarkAsViewed},h=a.getJsonPostRequestObj(i.QueueApi+"/"+d.itemId,m);h.success(function(e){l.gaEvent(f,"markAsViewSuccess"),n(200),c.addItem(e).then(function(e){c.updateViewedCount()})}),h.fail(function(e,t,r){n(e.status),l.gaEvent(f,"markAsViewFail")})}l.gaEvent(f,e.name)}else e.name==i.MessageGetBookmarkTags?n(s.getBookmarkTags()):e.name==i.MessageGetGithubLinksInQueue?c.getItemsWithUrlPrefix([i.GithubPrefix,i.GithubGistPrefix]).toArray(function(e){n(e)}):e.name==i.MessageGetGithubLinksInBookmarks?u.getItemsWithUrlPrefix([i.GithubPrefix,i.GithubGistPrefix]).toArray(function(e){n(e)}):e.name==i.MessageOpenUrlInRightNav?chrome.tabs.query({active:!0,currentWindow:!0},function(t){chrome.tabs.sendMessage(t[0].id,e)}):e.name==i.MessageGetValueLocalDb?(n(s.getItem(e.key)),l.gaEvent(f,e.name)):e.name==i.MessageSetValueLocalDb?(n(s.setItem(e.key,e.value)),l.gaEvent(f,e.name)):e.name==i.MessageGAEvent&&l.gaEvent(e.eventCategory,e.eventAction);return!0}function o(e){chrome.tabs.query({currentWindow:!0},function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].url);chrome.extension.sendMessage({message:i.ResponseOpenTabUrls,data:t},function(){})})}var i=e("./constants.js"),a=e("./api.js"),s=e("./db.js"),u=e("./bookmarksDb.js"),c=e("./queueDb.js"),l=e("./util.js"),f="message",h=function(){l.getBrowser()==i.Firefox?browser.runtime.onMessage.addListener(r):chrome.extension.onMessage.addListener(r)};t.exports={activateListener:h}},{"./api.js":2,"./bookmarksDb.js":3,"./constants.js":4,"./db.js":5,"./queueDb.js":8,"./util.js":9}],7:[function(e,t,n){"use strict";function r(e){}function o(e){chrome.tabs.create({url:e})}function i(e,t,n){var r={type:"basic",title:t,message:n,iconUrl:"icon128.png",buttons:[{title:"open"}]};chrome.notifications.create(e,r,null)}function a(e,t,n){var r={type:"basic",title:t,message:n,iconUrl:"icon128.png",buttons:[{title:"copy"}]};chrome.notifications.create(e,r,null)}function s(e){if(chrome.notifications.clear(e),e==l.LoginNotificationId)return void o(l.LoginPageUrl);var t=e.split(";"),n=t[0],r=t[1];if(n==l.GCMTypeQueue)d.getCollection(r).each(function(e){if(e&&e.itemId==r)return o(e.url),!1}).catch(function(e){});else if(n==l.GCMTypeShared)for(var i=f.getSharedData(),a=0;a<i.length;a++)i[a].itemId.toString()==r&&(i[a].type==l.TypeUrl?o(i[a].content):u(i[a].content))}function u(e){var t=document.createElement("textarea");t.textContent=e;var n=document.getElementsByTagName("body")[0];n.appendChild(t),t.select(),document.execCommand("copy"),n.removeChild(t)}function c(e,t){return e+";"+t}var l=e("./constants.js"),f=e("./db.js"),h=e("./util.js"),d=e("./queueDb.js"),m="Received a link",g="Received a text",p="notify",v=function(){var e=chrome.gcm.onMessage.hasListeners();e||(chrome.gcm.onMessage.addListener(function(e){if(f.getAuthToken()&&f.getAuthToken().length>0){var e,t=e.data;t.message&&(e=JSON.parse(t.message)),f.getDirectedId()==t.directedId&&b(t.type,t.action,e)}}),chrome.notifications.onClicked.addListener(s),chrome.notifications.onButtonClicked.addListener(s))},y=function(e,t,n){return $.ajax({url:e,type:t,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+localStorage.getItem(l.AuthTokenKey))},data:n})},b=function(e,t,n){if(h.gaEvent(p,"handleGcmMessage",e),e==l.GCMTypeQueue)return void k(t,n);if(e==l.GCMTypeShared)return void w(t,n);if(e==l.GCMTypeTagsUpdate){var r=y(l.TagsApi,"GET",{});r.success(function(e){f.updateBookmarkTags(e.tags),h.gaEvent(p,"syncBookmarkTagsSucces")}),r.fail(function(e,t,n){h.gaEvent(p,"syncBookmarkTagsFail",e.status)})}else if(e==l.GCMTypeDevicesUpdate){var r=y(l.DevicesApi,"GET",{});r.success(function(e){f.updateDevicesList(e.devices),h.gaEvent(p,"syncDeviceListSuccess")}),r.fail(function(e,t,n){h.gaEvent(p,"syncBookmarkTagsFail",e.status)})}else e==l.GCMTypeLogout},k=function(e,t){var n=Date.now();d.getItem(t.itemId).then(function(e){d.addItem(t).then(function(e){d.updateViewedCount()}).catch(function(e){}),void 0!=e?r(t):e.created!=t.created?r(t):t.updated-n<l.FiveMinutesInMs&&r(t)}).catch(function(e){d.addItem(t).then(function(e){d.updateViewedCount()}).catch(function(e){}),r(t)})},w=function(e,t){var n=f.getSharedItem(t.itemId);f.addToShared(t);var r=!0,s=Date.now();void 0!=n&&n.created-s>l.FiveMinutesInMs&&(r=!1),r&&f.getBoolean(l.DisplayNotificationsKey)&&(t.type==l.TypeUrl?f.getBoolean(l.SharedNotificationsKey)&&(i(c(l.GCMTypeShared,t.itemId),m,t.content),f.getBoolean(l.SharedOpenNewTabKey)&&o(t.content)):f.getBoolean(l.SharedNotificationsKey)&&a(c(l.GCMTypeShared,t.itemId),g,t.content))},x=function(){var e={type:"basic",title:"Login to Voblet",message:"You are not logged in to Voblet.Click to login",iconUrl:"icon128.png"};chrome.notifications.create(l.LoginNotificationId,e,null)};t.exports={activateGCMListener:v,showLoginNotification:x,handleQueueGCM:k}},{"./constants.js":4,"./db.js":5,"./queueDb.js":8,"./util.js":9}],8:[function(e,t,n){"use strict";function r(){try{x.version(1).stores({queue:"itemId,url,created,updated"})}catch(e){}x.open().catch(function(e){})}function o(e){return e.searchText=m(e),new Promise(function(t,n){x.queue.put(e).then(function(e){t(e),p()}).catch(function(e){n(e)})})}function i(e){return new Promise(function(t,n){x.queue.delete(e).then(function(e){t(e),p()}).catch(function(e){n(e)})})}function a(e){return x.queue.get(e)}function s(e){return x.queue.reverse()}function u(e){return x.queue.where("url").equalsIgnoreCase(e).limit(1)}function c(e){return x.queue.where("url").startsWithAnyOfIgnoreCase(e)}function l(e,t){x.transaction("rw",x.queue,function(){for(var n=0;n<e.length;n++){var r=e[n];r.searchText=m(r),x.queue.put(r).catch(function(e){y.setQueueLastUpdatedTimestamp(0),t(b.Fail,b.DatabaseErr,e)})}}).then(function(e){t(b.Success),p()}).catch(function(e){y.setQueueLastUpdatedTimestamp(0),t(b.Fail,b.DatabaseErr,e),k.gaEvent(w,"bulkInsertFail")})}function f(e,t){x.transaction("rw",x.queue,function(){for(var n=0;n<e.length;n++){var r=e[n];"D"!=r.updateAction?(r.searchText=m(r),x.queue.put(r).catch(function(e){y.setQueueLastUpdatedTimestamp(0),t(b.Fail,b.DatabaseErr,e)})):x.queue.delete(r.itemId).catch(function(e){y.setQueueLastUpdatedTimestamp(0),t(b.Fail,b.DatabaseErr,e)})}}).then(function(e){t(b.Success),p()}).catch(function(e){y.setQueueLastUpdatedTimestamp(0),t(b.Fail,b.DatabaseErr,e),k.gaEvent(w,"bulkInsertOnUpdateActionFail")})}function h(e,t){e==b.OldestFirst?x.queue.orderBy("created").toArray(function(e){t(b.Success,e)}).catch(function(e){t(b.Fail,b.DatabaseErr,e)}):x.queue.orderBy("created").reverse().toArray(function(e){t(b.Success,e)}).catch(function(e){t(b.Fail,b.DatabaseErr,e)})}function d(){x.queue.filter(function(e){return e.isViewed===!1}).count(function(e){k.setBadgeText(e)})}function m(e){var t=e.note+T+e.url+T+e.urlTitle+T+e.urlImage;return t.toLowerCase()}function g(){return x.queue.clear()}function p(){chrome.tabs&&chrome.tabs.query({url:["*://github.com/*","*://gist.github.com/*"]},function(e){for(var t=0;t<e.length;t++)chrome.tabs.sendMessage(e[t].id,{name:b.MessageQueueUpdated})})}var v=e("dexie"),y=e("./db.js"),b=e("./constants.js"),k=e("./util.js"),w="queueDb",x=new v("Queue"),T="fds{|}";t.exports={setup:r,addItem:o,getItem:a,getAll:h,getCollection:s,getItemByUrl:u,getItemsWithUrlPrefix:c,deleteAll:g,bulkInsert:l,deleteItem:i,updateViewedCount:d,bulkInsertBasedOnUpdateAction:f}},{"./constants.js":4,"./db.js":5,"./util.js":9,dexie:10}],9:[function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e){var t=/(http|https|chrome-extension):\/\/(\w+:{0,1}\w*)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%!\-\/]))?/;return!!t.test(e)}function i(){return self.innerWidth?self.innerWidth:document.documentElement&&document.documentElement.clientWidth?document.documentElement.clientWidth:document.body?document.body.clientWidth:void 0}function a(){chrome.runtime.sendMessage({name:c.RefreshContextMenu},null)}
function s(){chrome.windows.getAll({populate:!0},function(e){for(var t,n=e.length,r=0;r<n;r++){t=e[r];for(var o=t.tabs.length,i=0;i<o;i++){var a=t.tabs[i];a.url.match(/(chrome|chrome-extension):\/\//gi)||(chrome.tabs.insertCSS(a.id,{file:"css/contentScriptStyle.css"}),chrome.tabs.executeScript(a.id,{file:"js/jquery-2.1.1.min.js"}),chrome.tabs.executeScript(a.id,{file:"contentScript.js"}))}}})}var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},c=e("./constants.js"),l=function(){return chrome.app.getDetails().version},f=function(){return c.Chrome},h=function(){chrome.extension&&chrome.tabs?(chrome.extension.sendMessage({name:c.MessageActivateTabListener},null),chrome.tabs.create({active:!0,url:c.LoginPageUrl})):window.location.href=c.LoginPageUrl},d=function(e){f()==c.Firefox?browser.runtime.sendMessage(e):chrome.extension.sendMessage(e,null)},m=function(e){chrome.tabs.query({active:!0,lastFocusedWindow:!0},function(t){chrome.tabs.sendMessage(t[0].id,{type:c.MessageShowToast,message:e},null)})},g=function(e){chrome.tabs.query({currentWindow:!0,active:!0},function(t){chrome.tabs.sendMessage(t[0].id,{type:c.MessageShowAddTagsDialog,tags:e},null)})},p=function(e){chrome.tabs.getSelected(null,function(t){chrome.tabs.sendMessage(t.id,{type:c.MessageCloseAddTagsDialog,message:e},null)})},v=function(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)});return t},y=function(e){var t=new Date(e),n=["Jan","Feb","Mar","Apr","May","Jun","July","Aug","Sep","Oct","Nov","Dec"],r=(t.getFullYear(),n[t.getMonth()]),o=t.getDate();o<10&&(o="0"+o),r<10&&(r="0"+r);var i=t.getHours(),a=i>=12?"PM":"AM";i%=12,i=i?i:12,i<10&&(i="0"+i);var s=t.getMinutes();s<10&&(s="0"+s);var u=t.getSeconds();u<10&&(u="0"+u);var c=r+" "+o+", "+i+":"+s+" "+a;return c},b=function(e){var t=document.createElement("a");return t.href=e,t.hostname},k=function(e,t){return null==e&&(e=[]),null==t&&(t=[]),e.sort().toString()==t.sort().toString()},w=function(e){return!(e.length>c.BookmarkTagMaxLength)&&!(e.indexOf(",")>-1)},x=function(e){for(var t={},n=[],r=e.length,o=0,i=0;i<r;i++){var a=e[i];1!==t[a]&&(t[a]=1,n[o++]=a)}return n},T=function(e,t,n){void 0!=("undefined"==typeof _gaq?"undefined":u(_gaq))&&_gaq.push(["_trackEvent",e,t,n])},I=function(e){var t,n,r,o=document.getElementById(e),a=o.getBoundingClientRect(),s=document.getElementById(c.MainTag),u=0,l=0;return s&&(u=s.scrollTop?s.scrollTop:document.body.scrollTop,l=s.scrollLeft?s.scrollLeft:document.body.scrollLeft),n=a.top+u,t=a.left+l,r=i()-a.right,{top:n,left:t,right:r}},_=function(e){var t="",n="",o="",i="",a="",s="",u=r({title:""},"title",""),c="http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent('select * from html where url="'+e+'"')+"and xpath='//head'";return $.ajax({url:c,type:"get",dataType:"html",async:!1,timeout:500,success:function(e){var r=$(e),c=r.find("title").text();$(e).find("meta").each(function(){var e=$(this);"og:title"==e.attr("property")&&(t=e.attr("content")),"og:image"==e.attr("property")&&(o=e.attr("content")),"twitter:title"!=e.attr("name")&&"twitter:title"!=e.attr("property")||(n=e.attr("content")),"twitter:image"!=e.attr("name")&&"twitter:image"!=e.attr("property")||(i=e.attr("content"))}),""!=c?a=c:""!=t?a=t:""!=n&&(a=n),""!=o?s=o:""!=i&&(s=i),u={title:a,image:s}}}),u},S=function(e){0==e?(chrome.browserAction.setBadgeBackgroundColor({color:"#50BCB6"}),chrome.browserAction.setBadgeText({text:""})):(chrome.browserAction.setBadgeBackgroundColor({color:"#50BCB6"}),chrome.browserAction.setBadgeText({text:""+e}))},A=function(e){return"facebook.com"==e||"m.facebook.com"==e||"fb.com"==e?c.FacebookIcon:"www.youtube.com"==e||"youtube.com"==e||"m.youtube.com"==e||"youtu.be"==e?c.YoutubeIcon:"twitter.com"==e||"m.twitter.com"==e||"t.co"==e?c.TwitterIcon:""};t.exports={getVersionNumber:l,generateUUID:v,getDomainName:b,getReadableTime:y,showToastInTab:m,isValidUrl:o,areArraysEqual:k,removeDuplicatesInArray:x,showAddTagsDialog:g,closeAddTagsDialog:p,gaEvent:T,getOffsetPosition:I,isValidBookmarkTag:w,getUrlData:_,setBadgeText:S,getUrlImageForThisDomain:A,updateContextMenu:a,injectContentScript:s,getBrowser:f,sendMessage:d,openLoginPage:h}},{"./constants.js":4}],10:[function(e,t,n){(function(e){!function(e,r){"object"==typeof n&&"undefined"!=typeof t?t.exports=r():"function"==typeof define&&define.amd?define(r):e.Dexie=r()}(this,function(){"use strict";function t(e,t){Ie=e,_e=t}function n(){if(Se)try{throw n.arguments,new Error}catch(e){return e}return new Error}function r(e,t){var n=e.stack;return n?(t=t||0,0===n.indexOf(e.name)&&(t+=(e.name+e.message).split("\n").length),n.split("\n").slice(t).filter(_e).map(function(e){return"\n"+e}).join("")):""}function o(){}function i(e){return e}function a(e,t){return null==e||e===i?t:function(n){return t(e(n))}}function s(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function u(e,t){return e===o?t:function(){var n=e.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var i=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?s(r,this.onsuccess):r),o&&(this.onerror=this.onerror?s(o,this.onerror):o),void 0!==i?i:n}}function c(e,t){return e===o?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?s(n,this.onsuccess):n),r&&(this.onerror=this.onerror?s(r,this.onerror):r)}}function l(e,t){return e===o?t:function(n){var r=e.apply(this,arguments);d(n,r);var o=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var a=t.apply(this,arguments);return o&&(this.onsuccess=this.onsuccess?s(o,this.onsuccess):o),i&&(this.onerror=this.onerror?s(i,this.onerror):i),void 0===r?void 0===a?void 0:a:d(r,a)}}function f(e,t){return e===o?t:function(){return t.apply(this,arguments)!==!1&&e.apply(this,arguments)}}function h(e,t){return e===o?t:function(){var n=e.apply(this,arguments);if(n&&"function"==typeof n.then){for(var r=this,o=arguments.length,i=new Array(o);o--;)i[o]=arguments[o];return n.then(function(){return t.apply(r,i)})}return t.apply(this,arguments)}}function d(e,t){return"object"!=typeof t?e:(Ae(t).forEach(function(n){e[n]=t[n]}),e)}function m(e,t){return Ee.call(e,t)}function g(e,t){"function"==typeof t&&(t=t(Ce(e))),Ae(t).forEach(function(n){p(e,n,t[n])})}function p(e,t,n,r){Object.defineProperty(e,t,d(n&&m(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function v(e){return{from:function(t){return e.prototype=Object.create(t.prototype),p(e.prototype,"constructor",e),{extend:g.bind(null,e.prototype)}}}}function y(e,t){var n,r=Be(e,t);return r||(n=Ce(e))&&y(n,t)}function b(e,t,n){return je.call(e,t,n)}function k(e,t){return t(e)}function w(e){var t=setTimeout(e,1e3);clearTimeout(t)}function x(e){if(!e)throw new Qe.Internal("Assertion failed")}function T(e){De.setImmediate?setImmediate(e):setTimeout(e,0)}function I(e,t){return e.reduce(function(e,n,r){var o=t(n,r);return o&&(e[o[0]]=o[1]),e},{})}function _(e,t){return function(){try{e.apply(this,arguments)}catch(e){t(e)}}}function S(e,t,n){try{e.apply(null,n)}catch(e){t&&t(e)}}function A(e,t){var n=G.reject(e);return t?n.uncaught(t):n}function M(e,t){if(m(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var n=[],r=0,o=t.length;r<o;++r){var i=M(e,t[r]);n.push(i)}return n}var a=t.indexOf(".");if(a!==-1){var s=e[t.substr(0,a)];return void 0===s?void 0:M(s,t.substr(a+1))}}function D(e,t,n){if(e&&void 0!==t&&!("isFrozen"in Object&&Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){x("string"!=typeof n&&"length"in n);for(var r=0,o=t.length;r<o;++r)D(e,t[r],n[r])}else{var i=t.indexOf(".");if(i!==-1){var a=t.substr(0,i),s=t.substr(i+1);if(""===s)void 0===n?delete e[a]:e[a]=n;else{var u=e[a];u||(u=e[a]={}),D(u,s,n)}}else void 0===n?delete e[t]:e[t]=n}}function C(e,t){"string"==typeof t?D(e,t,void 0):"length"in t&&[].map.call(t,function(t){D(e,t,void 0)})}function E(e){var t={};for(var n in e)m(e,n)&&(t[n]=e[n]);return t}function B(e){if(!e||"object"!=typeof e)return e;var t;if(Me(e)){t=[];for(var n=0,r=e.length;n<r;++n)t.push(B(e[n]))}else if(e instanceof Date)t=new Date,t.setTime(e.getTime());else{t=e.constructor?Object.create(e.constructor.prototype):{};for(var o in e)m(e,o)&&(t[o]=B(e[o]))}return t}function j(e,t,n,r){return n=n||{},r=r||"",Ae(e).forEach(function(o){if(m(t,o)){var i=e[o],a=t[o];"object"==typeof i&&"object"==typeof a&&i&&a&&i.constructor===a.constructor?j(i,a,n,r+o+"."):i!==a&&(n[r+o]=t[o])}else n[r+o]=void 0}),Ae(t).forEach(function(o){m(e,o)||(n[r+o]=t[o])}),n}function U(e){var t,n,r,o;if(1===arguments.length){if(Me(e))return e.slice();if(this===Le&&"string"==typeof e)return[e];if(o=Oe(e)){for(n=[];r=o.next(),!r.done;)n.push(r.value);return n}if(null==e)return[e];if(t=e.length,"number"==typeof t){for(n=new Array(t);t--;)n[t]=e[t];return n}return[e]}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}function O(e){return Pe.apply([],e)}function L(e,t){this._e=n(),this.name=e,this.message=t}function P(e,t){return e+". Errors: "+t.map(function(e){return e.toString()}).filter(function(e,t,n){return n.indexOf(e)===t}).join("\n")}function F(e,t,r,o){this._e=n(),this.failures=t,this.failedKeys=o,this.successCount=r}function q(e,t){this._e=n(),this.name="BulkError",this.failures=t,this.message=P(e,t)}function K(e,t){if(!e||e instanceof L||e instanceof TypeError||e instanceof SyntaxError||!e.name||!Ve[e.name])return e;var n=new Ve[e.name](t||e.message,e);return"stack"in e&&p(n,"stack",{get:function(){return this.inner.stack}}),n}function N(e){function t(e,t,i){if("object"==typeof e)return n(e);t||(t=f),i||(i=o);var s={subscribers:[],fire:i,subscribe:function(e){s.subscribers.indexOf(e)===-1&&(s.subscribers.push(e),s.fire=t(s.fire,e))},unsubscribe:function(e){s.subscribers=s.subscribers.filter(function(t){return t!==e}),s.fire=s.subscribers.reduce(t,i)}};return r[e]=a[e]=s,s}function n(e){Ae(e).forEach(function(n){var r=e[n];if(Me(r))t(n,e[n][0],e[n][1]);else{if("asap"!==r)throw new Qe.InvalidArgument("Invalid event config");var o=t(n,i,function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];o.subscribers.forEach(function(e){T(function(){e.apply(null,t)})})})}})}var r={},a=function(t,n){if(n){for(var o=arguments.length,i=new Array(o-1);--o;)i[o-1]=arguments[o];return r[t].subscribe.apply(null,i),e}if("string"==typeof t)return r[t]};a.addEventType=t;for(var s=1,u=arguments.length;s<u;++s)t(arguments[s]);return a}function G(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=o,this._lib=!1;var t=this._PSD=at;if(Ie&&(this._stackHolder=n(),this._prev=null,this._numPrev=0,$(this,rt)),"function"!=typeof e){if(e!==ze)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&V(this,this._value))}this._state=null,this._value=null,++t.ref,Q(this,e)}function R(e,t,n,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r,this.psd=at}function Q(e,t){try{t(function(t){if(null===e._state){if(t===e)throw new TypeError("A promise cannot be resolved with itself.");var n=e._lib&&X();t&&"function"==typeof t.then?Q(e,function(e,n){t instanceof G?t._then(e,n):t.then(e,n)}):(e._state=!0,e._value=t,W(e)),n&&Z()}},V.bind(null,e))}catch(t){V(e,t)}}function V(e,t){if(nt.push(t),null===e._state){var n=e._lib&&X();t=ot(t),e._state=!1,e._value=t,Ie&&null!==t&&"object"==typeof t&&!t._promise&&S(function(){var n=y(t,"stack");t._promise=e,p(t,"stack",{get:function(){return $e?n&&(n.get?n.get.apply(t):n.value):e.stack}})}),ne(e),W(e),n&&Z()}}function W(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)z(e,t[n]);var o=e._PSD;--o.ref||o.finalize(),0===ut&&(++ut,Xe(function(){0===--ut&&ee()},[]))}function z(e,t){if(null===e._state)return void e._listeners.push(t);var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return(e._state?t.resolve:t.reject)(e._value);var r=t.psd;++r.ref,++ut,Xe(J,[n,e,t])}function J(e,t,n){var r=at,o=n.psd;try{o!==r&&(at=o),rt=t;var i,a=t._value;t._state?i=e(a):(nt.length&&(nt=[]),i=e(a),nt.indexOf(a)===-1&&re(t)),n.resolve(i)}catch(e){n.reject(e)}finally{o!==r&&(at=r),rt=null,0===--ut&&ee(),--o.ref||o.finalize()}}function H(e,t,n){if(t.length===n)return t;var o="";if(e._state===!1){var i,a,s=e._value;null!=s?(i=s.name||"Error",a=s.message||s,o=r(s,0)):(i=s,a=""),t.push(i+(a?": "+a:"")+o)}return Ie&&(o=r(e._stackHolder,2),o&&t.indexOf(o)===-1&&t.push(o),e._prev&&H(e._prev,t,n)),t}function $(e,t){var n=t?t._numPrev+1:0;n<Je&&(e._prev=t,e._numPrev=n)}function Y(){X()&&Z()}function X(){var e=Ze;return Ze=!1,et=!1,e}function Z(){var e,t,n;do for(;st.length>0;)for(e=st,st=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}while(st.length>0);Ze=!0,et=!0}function ee(){var e=tt;tt=[],e.forEach(function(e){e._PSD.onunhandled.call(null,e._value,e)});for(var t=ct.slice(0),n=t.length;n;)t[--n]()}function te(e){function t(){e(),ct.splice(ct.indexOf(t),1)}ct.push(t),++ut,Xe(function(){0===--ut&&ee()},[])}function ne(e){tt.some(function(t){return t._value===e._value})||tt.push(e)}function re(e){for(var t=tt.length;t;)if(tt[--t]._value===e._value)return void tt.splice(t,1)}function oe(e){}function ie(e){return new G(ze,(!1),e)}function ae(e,t){var n=at;return function(){var r=X(),o=at;try{return o!==n&&(at=n),e.apply(this,arguments)}catch(e){t&&t(e)}finally{o!==n&&(at=o),r&&Z()}}}function se(e,t,n,r){var o=at,i=Object.create(o);i.parent=o,i.ref=0,i.global=!1,++o.ref,i.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=ue(i,e,t,n,r);return 0===i.ref&&i.finalize(),a}function ue(e,t,n,r,o){var i=at;try{return e!==i&&(at=e),t(n,r,o)}finally{e!==i&&(at=i)}}function ce(e,t){var n;try{n=t.onuncatched(e)}catch(e){}if(n!==!1)try{G.on.error.fire(e,t)}catch(e){}}function le(e,t){function r(){tt.on("versionchange",function(e){e.newVersion>0,tt.close()}),tt.on("blocked",function(e){!e.newVersion||e.newVersion<e.oldVersion})}function s(e){this._cfg={version:e,storesSource:null,dbschema:{},tables:{},contentUpgrade:null},this.stores({})}function f(e,t,n){var r=tt._createTransaction(et,ze,Ve);r.create(t),r._completion.catch(n);var o=r._reject.bind(r);se(function(){at.trans=r,0===e?(Ae(Ve).forEach(function(e){C(t,e,Ve[e].primKey,Ve[e].indexes)}),G.follow(function(){return tt.on.populate.fire(r)}).catch(o)):y(e,r,t).catch(o)})}function y(e,t,n){function r(){return o.length?G.resolve(o.shift()(t.idbtrans)).then(r):G.resolve()}var o=[],i=We.filter(function(t){return t._cfg.version===e})[0];if(!i)throw new Qe.Upgrade("Dexie specification of currently installed DB version is missing");Ve=tt._dbSchema=i._cfg.dbschema;var a=!1,s=We.filter(function(t){return t._cfg.version>e});return s.forEach(function(e){o.push(function(){var r=Ve,o=e._cfg.dbschema;Be(r,n),Be(o,n),Ve=tt._dbSchema=o;var i=T(r,o);if(i.add.forEach(function(e){C(n,e[0],e[1].primKey,e[1].indexes)}),i.change.forEach(function(e){if(e.recreate)throw new Qe.Upgrade("Not yet support for changing primary key");var t=n.objectStore(e.name);e.add.forEach(function(e){K(t,e)}),e.change.forEach(function(e){t.deleteIndex(e.name),K(t,e)}),e.del.forEach(function(e){t.deleteIndex(e)})}),e._cfg.contentUpgrade)return a=!0,G.follow(function(){e._cfg.contentUpgrade(t)})}),o.push(function(t){if(a&&!vt){var n=e._cfg.dbschema;P(n,t)}})}),r().then(function(){L(Ve,n)})}function T(e,t){var n={del:[],add:[],change:[]};for(var r in e)t[r]||n.del.push(r);for(r in t){var o=e[r],i=t[r];if(o){var a={name:r,def:i,recreate:!1,del:[],add:[],change:[]};if(o.primKey.src!==i.primKey.src)a.recreate=!0,n.change.push(a);else{var s=o.idxByName,u=i.idxByName;for(var c in s)u[c]||a.del.push(c);for(c in u){var l=s[c],f=u[c];l?l.src!==f.src&&a.change.push(f):a.add.push(f)}(a.del.length>0||a.add.length>0||a.change.length>0)&&n.change.push(a)}}else n.add.push([r,i])}return n}function C(e,t,n,r){var o=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(e){K(o,e)}),o}function L(e,t){Ae(e).forEach(function(n){t.db.objectStoreNames.contains(n)||C(t,n,e[n].primKey,e[n].indexes)})}function P(e,t){for(var n=0;n<t.db.objectStoreNames.length;++n){var r=t.db.objectStoreNames[n];null==e[r]&&t.db.deleteObjectStore(r)}}function K(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function R(e){return tt.on.error.fire(e)}function Q(e,t,n){if(Xe||at.letThrough){var r=tt._createTransaction(e,t,Ve);return r._promise(e,function(e,t){se(function(){at.trans=r,n(e,t,r)})}).then(function(e){return r._completion.then(function(){return e})})}if(!Ye){if(!Ne)return A(new Qe.DatabaseClosed,R);tt.open().catch(o)}return nt.then(function(){return Q(e,t,n)})}function V(e,t,n){this.name=e,this.schema=t,this.hook=Je[e]?Je[e].hook:N(null,{creating:[u,o],reading:[a,i],updating:[l,o],deleting:[c,o]}),this._collClass=n||Y}function W(e,t,n){V.call(this,e,t,n||Z)}function z(e,t,n){return(n?pe:ge)(function(n){e.push(n),t&&t()})}function J(e,t,n,r,o){return new G(function(i,a){var s=n.length,u=s-1;if(0===s)return i();if(r){var c,l=pe(a),f=me(null);S(function(){for(var r=0;r<s;++r){c={onsuccess:null,onerror:null};var a=n[r];o.call(c,a[0],a[1],t);var h=e.delete(a[0]);h._hookCtx=c,h.onerror=l,r===u?h.onsuccess=me(i):h.onsuccess=f}},function(e){throw c.onerror&&c.onerror(e),e})}else for(var h=0;h<s;++h){var d=e.delete(n[h]);d.onerror=ae(ge(a)),h===u&&(d.onsuccess=ae(function(){return i()}))}}).uncaught(R)}function H(e,t,n,r){var o=this;this.db=tt,this.mode=e,this.storeNames=t,this.idbtrans=null,this.on=N(this,"complete","error","abort"),this.parent=r||null,this.active=!0,this._tables=null,this._reculock=0,this._blockedFuncs=[],this._psd=null,this._dbschema=n,this._resolve=null,this._reject=null,this._completion=new G(function(e,t){o._resolve=e,o._reject=t}).uncaught(R),this._completion.then(function(){o.on.complete.fire()},function(e){return o.on.error.fire(e),o.parent?o.parent._reject(e):o.active&&o.idbtrans&&o.idbtrans.abort(),o.active=!1,A(e)})}function $(e,t,n){this._ctx={table:e,index:":id"===t?null:t,collClass:e._collClass,or:n}}function Y(e,t){var n=null,r=null;if(t)try{n=t()}catch(e){r=e}var o=e._ctx,i=o.table;this._ctx={table:i,index:o.index,isPrimKey:!o.index||i.schema.primKey.keyPath&&o.index===i.schema.primKey.name,range:n,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:r,or:o.or,valueMapper:i.hook.reading.fire}}function X(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Z(){Y.apply(this,arguments)}function ee(e,t){return e._cfg.version-t._cfg.version}function te(e,t,n,r){t.forEach(function(t){var o=tt._tableFactory(n,r[t]);e.forEach(function(e){t in e||(e[t]=o)})})}function ne(e){e.forEach(function(e){for(var t in e)e[t]instanceof V&&delete e[t]})}function re(e,t,n,r,o,i){var a=i?function(e,t,r){return n(i(e),t,r)}:n,s=ae(a,o);e.onerror||(e.onerror=ge(o)),t?e.onsuccess=_(function(){var n=e.result;if(n){var i=function(){n.continue()};t(n,function(e){i=e},r,o)&&s(n.value,n,function(e){i=e}),i()}else r()},o):e.onsuccess=_(function(){var t=e.result;if(t){var n=function(){t.continue()};s(t.value,t,function(e){n=e}),n()}else r()},o)}function oe(e){var t=[];return e.split(",").forEach(function(e){e=e.trim();var n=e.replace(/([&*]|\+\+)/g,""),r=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;t.push(new ke(n,r||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),Me(r),/\./.test(e)))}),t}function ie(e,t){return Ge.cmp(e,t)}function ue(e,t){return ie(e,t)<0?e:t}function ce(e,t){return ie(e,t)>0?e:t}function fe(e,t){return Ge.cmp(e,t)}function _e(e,t){return Ge.cmp(t,e)}function Se(e,t){return e<t?-1:e===t?0:1}function De(e,t){return e>t?-1:e===t?0:1}function Ce(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}function Ee(){if(tt.verno=He.version/10,tt._dbSchema=Ve={},ze=b(He.objectStoreNames,0),0!==ze.length){var e=He.transaction(xe(ze),"readonly");ze.forEach(function(t){for(var n=e.objectStore(t),r=n.keyPath,o=r&&"string"==typeof r&&r.indexOf(".")!==-1,i=new ke(r,r||"",(!1),(!1),(!!n.autoIncrement),r&&"string"!=typeof r,o),a=[],s=0;s<n.indexNames.length;++s){var u=n.index(n.indexNames[s]);r=u.keyPath,o=r&&"string"==typeof r&&r.indexOf(".")!==-1;var c=new ke(u.name,r,(!!u.unique),(!!u.multiEntry),(!1),r&&"string"!=typeof r,o);a.push(c)}Ve[t]=new we(t,i,a,{})}),te([Je,H.prototype],Ae(Ve),et,Ve)}}function Be(e,t){for(var n=t.db.objectStoreNames,r=0;r<n.length;++r){var o=n[r],i=t.objectStore(o);Pe="getAll"in i;for(var a=0;a<i.indexNames.length;++a){var s=i.indexNames[a],u=i.index(s).keyPath,c="string"==typeof u?u:"["+b(u).join("+")+"]";if(e[o]){var l=e[o].idxByName[c];l&&(l.name=s)}}}}function je(e){tt.on("blocked").fire(e),gt.filter(function(e){return e.name===tt.name&&e!==tt&&!e._vcFired}).map(function(t){return t.on("versionchange").fire(e)})}var Ue,Oe,Pe,Fe=le.dependencies,qe=d({addons:le.addons,autoOpen:!0,indexedDB:Fe.indexedDB,IDBKeyRange:Fe.IDBKeyRange},t),Ke=qe.addons,Ne=qe.autoOpen,Ge=qe.indexedDB,Re=qe.IDBKeyRange,Ve=this._dbSchema={},We=[],ze=[],Je={},He=null,$e=null,Ye=!1,Xe=!1,Ze="readonly",et="readwrite",tt=this,nt=new G(function(e){Ue=e}),rt=new G(function(e,t){Oe=t}),ot=!0,it=!!Te(Ge);this.version=function(e){if(He||Ye)throw new Qe.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=We.filter(function(t){return t._cfg.version===e})[0];return t?t:(t=new s(e),We.push(t),We.sort(ee),t)},d(s.prototype,{stores:function(e){this._cfg.storesSource=this._cfg.storesSource?d(this._cfg.storesSource,e):e;var t={};We.forEach(function(e){d(t,e._cfg.storesSource)});var n=this._cfg.dbschema={};return this._parseStoresSpec(t,n),Ve=tt._dbSchema=n,ne([Je,tt,H.prototype]),te([Je,tt,H.prototype,this._cfg.tables],Ae(n),et,n),ze=Ae(n),this},upgrade:function(e){var t=this;return kt(function(){e(tt._createTransaction(et,Ae(t._cfg.dbschema),t._cfg.dbschema))}),this._cfg.contentUpgrade=e,this},_parseStoresSpec:function(e,t){Ae(e).forEach(function(n){if(null!==e[n]){var r={},o=oe(e[n]),i=o.shift();if(i.multi)throw new Qe.Schema("Primary key cannot be multi-valued");i.keyPath&&D(r,i.keyPath,i.auto?0:i.keyPath),o.forEach(function(e){if(e.auto)throw new Qe.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new Qe.Schema("Index must have a name and cannot be an empty string");D(r,e.keyPath,e.compound?e.keyPath.map(function(){return""}):"")}),t[n]=new we(n,i,o,r)}})}}),this._allTables=Je,this._tableFactory=function(e,t){return e===Ze?new V(t.name,t,Y):new W(t.name,t)},this._createTransaction=function(e,t,n,r){return new H(e,t,n,r)},this._whenReady=function(e){return new G(wt||Xe||at.letThrough?e:function(t,n){if(!Ye){if(!Ne)return void n(new Qe.DatabaseClosed);tt.open().catch(o)}nt.then(function(){e(t,n)})}).uncaught(R)},this.verno=0,this.open=function(){if(Ye||He)return nt.then(function(){return $e?A($e,R):tt});Ie&&(rt._stackHolder=n()),Ye=!0,$e=null,Xe=!1;var t=Ue,r=null;return G.race([rt,new G(function(t,n){if(w(function(){return t()}),We.length>0&&(ot=!1),!Ge)throw new Qe.MissingAPI("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using old Safari versions, make sure to include indexedDB polyfill.");var o=ot?Ge.open(e):Ge.open(e,Math.round(10*tt.verno));if(!o)throw new Qe.MissingAPI("IndexedDB API not available");o.onerror=ae(ge(n)),o.onblocked=ae(je),o.onupgradeneeded=ae(function(t){if(r=o.transaction,ot&&!tt._allowEmptyDB){o.onerror=ve,r.abort(),o.result.close();var i=Ge.deleteDatabase(e);i.onsuccess=i.onerror=ae(function(){n(new Qe.NoSuchDatabase("Database "+e+" doesnt exist"))})}else{r.onerror=ae(ge(n));var a=t.oldVersion>Math.pow(2,62)?0:t.oldVersion;f(a/10,r,n,o)}},n),o.onsuccess=ae(function(){if(r=null,He=o.result,gt.push(tt),ot)Ee();else if(He.objectStoreNames.length>0)try{Be(Ve,He.transaction(xe(He.objectStoreNames),Ze))}catch(e){}He.onversionchange=ae(function(e){tt._vcFired=!0,tt.on("versionchange").fire(e)}),it||ye(function(t){if(t.indexOf(e)===-1)return t.push(e)}),t()},n)})]).then(function(){return le.vip(tt.on.ready.fire)}).then(function(){return Ye=!1,tt}).catch(function(e){try{r&&r.abort()}catch(e){}return Ye=!1,tt.close(),$e=e,A($e,R)}).finally(function(){Xe=!0,t()})},this.close=function(){var e=gt.indexOf(tt);if(e>=0&&gt.splice(e,1),He){try{He.close()}catch(e){}He=null}Ne=!1,$e=new Qe.DatabaseClosed,Ye&&Oe($e),nt=new G(function(e){Ue=e}),rt=new G(function(e,t){Oe=t})},this.delete=function(){var t=arguments.length>0;return new G(function(n,r){function o(){tt.close();var t=Ge.deleteDatabase(e);t.onsuccess=ae(function(){it||ye(function(t){var n=t.indexOf(e);if(n>=0)return t.splice(n,1)}),n()}),t.onerror=ae(ge(r)),t.onblocked=je}if(t)throw new Qe.InvalidArgument("Arguments not allowed in db.delete()");Ye?nt.then(o):o()}).uncaught(R)},this.backendDB=function(){return He},this.isOpen=function(){return null!==He},this.hasFailed=function(){return null!==$e},this.dynamicallyOpened=function(){return ot},this.name=e,p(this,"tables",{get:function(){return Ae(Je).map(function(e){return Je[e]})}}),this.on=N(this,"error","populate","blocked","versionchange",{ready:[h,o]}),this.on.ready.subscribe=k(this.on.ready.subscribe,function(e){return function(t,n){le.vip(function(){e(t),n||e(function e(){tt.on.ready.unsubscribe(t),tt.on.ready.unsubscribe(e)})})}}),kt(function(){tt.on("populate").fire(tt._createTransaction(et,ze,Ve)),tt.on("error").fire(new Error)}),this.transaction=function(e,t,n){function r(t){var r=at;t(G.resolve().then(function(){return se(function(){at.transless=at.transless||r;var t=tt._createTransaction(e,c,Ve,s);at.trans=t,s?t.idbtrans=s.idbtrans:t.create();var o=c.map(function(e){return t.tables[e]});o.push(t);var i;return G.follow(function(){if(i=n.apply(t,o))if("function"==typeof i.next&&"function"==typeof i.throw)i=be(i);else if("function"==typeof i.then&&!m(i,"_PSD"))throw new Qe.IncompatiblePromise("Incompatible Promise returned from transaction scope (read more at http://tinyurl.com/znyqjqc). Transaction scope: "+n.toString())}).uncaught(R).then(function(){return s&&t._resolve(),t._completion}).then(function(){return i}).catch(function(e){return t._reject(e),A(e)})})}))}var o=arguments.length;if(o<2)throw new Qe.InvalidArgument("Too few arguments");for(var i=new Array(o-1);--o;)i[o-1]=arguments[o];n=i.pop();var a=O(i),s=at.trans;s&&s.db===tt&&e.indexOf("!")===-1||(s=null);var u=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");try{var c=a.map(function(e){var t=e instanceof V?e.name:e;if("string"!=typeof t)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return t});if("r"==e||e==Ze)e=Ze;else{if("rw"!=e&&e!=et)throw new Qe.InvalidArgument("Invalid transaction mode: "+e);e=et}if(s){if(s.mode===Ze&&e===et){if(!u)throw new Qe.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");s=null}s&&c.forEach(function(e){if(!m(s.tables,e)){if(!u)throw new Qe.SubTransaction("Table "+e+" not included in parent transaction.");s=null}})}}catch(e){return s?s._promise(null,function(t,n){n(e)}):A(e,R)}return s?s._promise(e,r,"lock"):tt._whenReady(r)},this.table=function(e){if(wt&&ot)return new W(e);if(!m(Je,e))throw new Qe.InvalidTable("Table "+e+" does not exist");return Je[e]},g(V.prototype,{_trans:function(e,t,n){var r=at.trans;return r&&r.db===tt?r._promise(e,t,n):Q(e,[this.name],t)},_idbstore:function(e,t,n){function r(e,n,r){t(e,n,r.idbtrans.objectStore(i),r)}if(wt)return new G(t);var o=at.trans,i=this.name;return o&&o.db===tt?o._promise(e,r,n):Q(e,[this.name],r)},get:function(e,t){var n=this;return this._idbstore(Ze,function(t,r,o){wt&&t(n.schema.instanceTemplate);var i=o.get(e);i.onerror=ge(r),i.onsuccess=function(){t(n.hook.reading.fire(i.result))}}).then(t)},where:function(e){return new $(this,e)},count:function(e){return this.toCollection().count(e)},offset:function(e){return this.toCollection().offset(e)},limit:function(e){return this.toCollection().limit(e)},reverse:function(){return this.toCollection().reverse()},filter:function(e){return this.toCollection().and(e)},each:function(e){return this.toCollection().each(e)},toArray:function(e){return this.toCollection().toArray(e)},orderBy:function(e){return new this._collClass(new $(this,e))},toCollection:function(){return new this._collClass(new $(this))},mapToClass:function(e,t){this.schema.mappedClass=e;var n=Object.create(e.prototype);t&&he(n,t),this.schema.instanceTemplate=n;var r=function(t){if(!t)return t;var n=Object.create(e.prototype);for(var r in t)m(t,r)&&(n[r]=t[r]);return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=r,this.hook("reading",r),e},defineClass:function(e){return this.mapToClass(le.defineClass(e),e)}}),v(W).from(V).extend({bulkDelete:function(e){return this.hook.deleting.fire===o?this._idbstore(et,function(t,n,r,i){t(J(r,i,e,!1,o))}):this.where(":id").anyOf(e).delete().then(function(){})},bulkPut:function(e,t){var n=this;return this._idbstore(et,function(r,i,a){if(!a.keyPath&&!n.schema.primKey.auto&&!t)throw new Qe.InvalidArgument("bulkPut() with non-inbound keys requires keys array in second argument");if(a.keyPath&&t)throw new Qe.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(t&&t.length!==e.length)throw new Qe.InvalidArgument("Arguments objects and keys must have the same length");if(0===e.length)return r();var s,u,c=function(e){0===l.length?r(e):i(new q(n.name+".bulkPut(): "+l.length+" of "+f+" operations failed",l))},l=[],f=e.length,h=n;if(n.hook.creating.fire===o&&n.hook.updating.fire===o){u=z(l);for(var d=0,m=e.length;d<m;++d)s=t?a.put(e[d],t[d]):a.put(e[d]),s.onerror=u;s.onerror=z(l,c),s.onsuccess=de(c)}else{var g=t||a.keyPath&&e.map(function(e){return M(e,a.keyPath)}),p=g&&I(g,function(t,n){return null!=t&&[t,e[n]]}),v=g?h.where(":id").anyOf(g.filter(function(e){return null!=e})).modify(function(){this.value=p[this.primKey],p[this.primKey]=null}).catch(F,function(e){l=e.failures}).then(function(){for(var n=[],r=t&&[],o=g.length-1;o>=0;--o){var i=g[o];(null==i||p[i])&&(n.push(e[o]),t&&r.push(i),null!=i&&(p[i]=null))}return n.reverse(),t&&r.reverse(),h.bulkAdd(n,r)}).then(function(e){var t=g[g.length-1];return null!=t?t:e}):h.bulkAdd(e);v.then(c).catch(q,function(e){l=l.concat(e.failures),c()}).catch(i)}},"locked")},bulkAdd:function(e,t){var n=this,r=this.hook.creating.fire;return this._idbstore(et,function(i,a,s,u){function c(e){0===d.length?i(e):a(new q(n.name+".bulkAdd(): "+d.length+" of "+m+" operations failed",d))}if(!s.keyPath&&!n.schema.primKey.auto&&!t)throw new Qe.InvalidArgument("bulkAdd() with non-inbound keys requires keys array in second argument");if(s.keyPath&&t)throw new Qe.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(t&&t.length!==e.length)throw new Qe.InvalidArgument("Arguments objects and keys must have the same length");if(0===e.length)return i();var l,f,h,d=[],m=e.length;if(r!==o){var g,p=s.keyPath;f=z(d,null,!0),h=me(null),S(function(){for(var n=0,o=e.length;n<o;++n){g={onerror:null,onsuccess:null};var i=t&&t[n],a=e[n],c=t?i:p?M(a,p):void 0,d=r.call(g,c,a,u);null==c&&null!=d&&(p?(a=B(a),D(a,p,d)):i=d),l=null!=i?s.add(a,i):s.add(a),l._hookCtx=g,n<o-1&&(l.onerror=f,g.onsuccess&&(l.onsuccess=h))}},function(e){throw g.onerror&&g.onerror(e),e}),l.onerror=z(d,c,!0),l.onsuccess=me(c)}else{f=z(d);for(var v=0,y=e.length;v<y;++v)l=t?s.add(e[v],t[v]):s.add(e[v]),
l.onerror=f;l.onerror=z(d,c),l.onsuccess=de(c)}})},add:function(e,t){var n=this.hook.creating.fire;return this._idbstore(et,function(r,i,a,s){var u={onsuccess:null,onerror:null};if(n!==o){var c=null!=t?t:a.keyPath?M(e,a.keyPath):void 0,l=n.call(u,c,e,s);null==c&&null!=l&&(a.keyPath?D(e,a.keyPath,l):t=l)}try{var f=null!=t?a.add(e,t):a.add(e);f._hookCtx=u,f.onerror=pe(i),f.onsuccess=me(function(t){var n=a.keyPath;n&&D(e,n,t),r(t)})}catch(e){throw u.onerror&&u.onerror(e),e}})},put:function(e,t){var n=this,r=this.hook.creating.fire,i=this.hook.updating.fire;return r!==o||i!==o?this._trans(et,function(r,o,i){var a=void 0!==t?t:n.schema.primKey.keyPath&&M(e,n.schema.primKey.keyPath);null==a?i.tables[n.name].add(e).then(r,o):(i._lock(),e=B(e),i.tables[n.name].where(":id").equals(a).modify(function(){this.value=e}).then(function(r){return 0===r?i.tables[n.name].add(e,t):a}).finally(function(){i._unlock()}).then(r,o))}):this._idbstore(et,function(n,r,o){var i=void 0!==t?o.put(e,t):o.put(e);i.onerror=ge(r),i.onsuccess=function(t){var r=o.keyPath;r&&D(e,r,t.target.result),n(i.result)}})},delete:function(e){return this.hook.deleting.subscribers.length?this.where(":id").equals(e).delete():this._idbstore(et,function(t,n,r){var o=r.delete(e);o.onerror=ge(n),o.onsuccess=function(){t(o.result)}})},clear:function(){return this.hook.deleting.subscribers.length?this.toCollection().delete():this._idbstore(et,function(e,t,n){var r=n.clear();r.onerror=ge(t),r.onsuccess=function(){e(r.result)}})},update:function(e,t){if("object"!=typeof t||Me(t))throw new Qe.InvalidArgument("Modifications must be an object.");if("object"!=typeof e||Me(e))return this.where(":id").equals(e).modify(t);Ae(t).forEach(function(n){D(e,n,t[n])});var n=M(e,this.schema.primKey.keyPath);return void 0===n?A(new Qe.InvalidArgument("Given object does not contain its primary key"),R):this.where(":id").equals(n).modify(t)}}),g(H.prototype,{_lock:function(){return x(!at.global),++this._reculock,1!==this._reculock||at.global||(at.lockOwnerFor=this),this},_unlock:function(){if(x(!at.global),0===--this._reculock)for(at.global||(at.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{e()}catch(e){}}return this},_locked:function(){return this._reculock&&at.lockOwnerFor!==this},create:function(e){var t=this;if(x(!this.idbtrans),!e&&!He)switch($e&&$e.name){case"DatabaseClosedError":throw new Qe.DatabaseClosed($e);case"MissingAPIError":throw new Qe.MissingAPI($e.message,$e);default:throw new Qe.OpenFailed($e)}if(!this.active)throw new Qe.TransactionInactive;return x(null===this._completion._state),e=this.idbtrans=e||He.transaction(xe(this.storeNames),this.mode),e.onerror=ae(function(n){ve(n),t._reject(e.error)}),e.onabort=ae(function(e){ve(e),t.active&&t._reject(new Qe.Abort),t.active=!1,t.on("abort").fire(e)}),e.oncomplete=ae(function(){t.active=!1,t._resolve()}),this},_promise:function(e,t,n){var r=this;return se(function(){var o;return r._locked()?o=new G(function(o,i){r._blockedFuncs.push(function(){r._promise(e,t,n).then(o,i)})}):(o=r.active?new G(function(o,i){if(e===et&&r.mode!==et)throw new Qe.ReadOnly("Transaction is readonly");!r.idbtrans&&e&&r.create(),n&&r._lock(),t(o,i,r)}):A(new Qe.TransactionInactive),r.active&&n&&o.finally(function(){r._unlock()})),o._lib=!0,o.uncaught(R)})},abort:function(){this.active&&this._reject(new Qe.Abort),this.active=!1},tables:{get:function(){return this._tables?this._tables:this._tables=I(this.storeNames,function(e){return[e,Je[e]]})}},complete:function(e){return this.on("complete",e)},error:function(e){return this.on("error",e)},table:function(e){if(this.storeNames.indexOf(e)===-1)throw new Qe.InvalidTable("Table "+e+" not in transaction");return Je[e]}}),g($.prototype,function(){function e(e,t,n){var r=e instanceof $?new e._ctx.collClass(e):e;return r._ctx.error=n?new n(t):new TypeError(t),r}function t(e){return new e._ctx.collClass(e,function(){return Re.only("")}).limit(0)}function n(e){return"next"===e?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()}}function r(e){return"next"===e?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()}}function o(e,t,n,r,o,i){for(var a=Math.min(e.length,r.length),s=-1,u=0;u<a;++u){var c=t[u];if(c!==r[u])return o(e[u],n[u])<0?e.substr(0,u)+n[u]+n.substr(u+1):o(e[u],r[u])<0?e.substr(0,u)+r[u]+n.substr(u+1):s>=0?e.substr(0,s)+t[s]+n.substr(s+1):null;o(e[u],c)<0&&(s=u)}return a<r.length&&"next"===i?e+n.substr(e.length):a<e.length&&"prev"===i?e.substr(0,n.length):s<0?null:e.substr(0,s)+r[s]+n.substr(s+1)}function i(t,i,a,s){function u(e){c=n(e),l=r(e),f="next"===e?Se:De;var t=a.map(function(e){return{lower:l(e),upper:c(e)}}).sort(function(e,t){return f(e.lower,t.lower)});h=t.map(function(e){return e.upper}),d=t.map(function(e){return e.lower}),m=e,g="next"===e?"":s}var c,l,f,h,d,m,g,p=a.length;if(!a.every(function(e){return"string"==typeof e}))return e(t,mt);u("next");var v=new t._ctx.collClass(t,function(){return Re.bound(h[0],d[p-1]+s)});v._ondirectionchange=function(e){u(e)};var y=0;return v._addAlgorithm(function(e,t,n){var r=e.key;if("string"!=typeof r)return!1;var a=l(r);if(i(a,d,y))return!0;for(var s=null,u=y;u<p;++u){var c=o(r,a,h[u],d[u],f,m);null===c&&null===s?y=u+1:(null===s||f(s,c)>0)&&(s=c)}return t(null!==s?function(){e.continue(s+g)}:n),!1}),v}return{between:function(n,r,o,i){o=o!==!1,i=i===!0;try{return ie(n,r)>0||0===ie(n,r)&&(o||i)&&(!o||!i)?t(this):new this._ctx.collClass(this,function(){return Re.bound(n,r,!o,!i)})}catch(t){return e(this,dt)}},equals:function(e){return new this._ctx.collClass(this,function(){return Re.only(e)})},above:function(e){return new this._ctx.collClass(this,function(){return Re.lowerBound(e,!0)})},aboveOrEqual:function(e){return new this._ctx.collClass(this,function(){return Re.lowerBound(e)})},below:function(e){return new this._ctx.collClass(this,function(){return Re.upperBound(e,!0)})},belowOrEqual:function(e){return new this._ctx.collClass(this,function(){return Re.upperBound(e)})},startsWith:function(t){return"string"!=typeof t?e(this,mt):this.between(t,t+ft,!0,!0)},startsWithIgnoreCase:function(e){return""===e?this.startsWith(e):i(this,function(e,t){return 0===e.indexOf(t[0])},[e],ft)},equalsIgnoreCase:function(e){return i(this,function(e,t){return e===t[0]},[e],"")},anyOfIgnoreCase:function(){var e=U.apply(Le,arguments);return 0===e.length?t(this):i(this,function(e,t){return t.indexOf(e)!==-1},e,"")},startsWithAnyOfIgnoreCase:function(){var e=U.apply(Le,arguments);return 0===e.length?t(this):i(this,function(e,t){return t.some(function(t){return 0===e.indexOf(t)})},e,ft)},anyOf:function(){var n=U.apply(Le,arguments),r=fe;try{n.sort(r)}catch(t){return e(this,dt)}if(0===n.length)return t(this);var o=new this._ctx.collClass(this,function(){return Re.bound(n[0],n[n.length-1])});o._ondirectionchange=function(e){r="next"===e?fe:_e,n.sort(r)};var i=0;return o._addAlgorithm(function(e,t,o){for(var a=e.key;r(a,n[i])>0;)if(++i,i===n.length)return t(o),!1;return 0===r(a,n[i])||(t(function(){e.continue(n[i])}),!1)}),o},notEqual:function(e){return this.inAnyRange([[-(1/0),e],[e,ht]],{includeLowers:!1,includeUppers:!1})},noneOf:function(){var t=U.apply(Le,arguments);if(0===t.length)return new this._ctx.collClass(this);try{t.sort(fe)}catch(t){return e(this,dt)}var n=t.reduce(function(e,t){return e?e.concat([[e[e.length-1][1],t]]):[[-(1/0),t]]},null);return n.push([t[t.length-1],ht]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})},inAnyRange:function(n,r){function o(e,t){for(var n=0,r=e.length;n<r;++n){var o=e[n];if(ie(t[0],o[1])<0&&ie(t[1],o[0])>0){o[0]=ue(o[0],t[0]),o[1]=ce(o[1],t[1]);break}}return n===r&&e.push(t),e}function i(e,t){return f(e[0],t[0])}function a(e){return!d(e)&&!m(e)}var s=this._ctx;if(0===n.length)return t(this);if(!n.every(function(e){return void 0!==e[0]&&void 0!==e[1]&&fe(e[0],e[1])<=0}))return e(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Qe.InvalidArgument);var u,c=!r||r.includeLowers!==!1,l=r&&r.includeUppers===!0,f=fe;try{u=n.reduce(o,[]),u.sort(i)}catch(t){return e(this,dt)}var h=0,d=l?function(e){return fe(e,u[h][1])>0}:function(e){return fe(e,u[h][1])>=0},m=c?function(e){return _e(e,u[h][0])>0}:function(e){return _e(e,u[h][0])>=0},g=d,p=new s.collClass(this,function(){return Re.bound(u[0][0],u[u.length-1][1],!c,!l)});return p._ondirectionchange=function(e){"next"===e?(g=d,f=fe):(g=m,f=_e),u.sort(i)},p._addAlgorithm(function(e,t,n){for(var r=e.key;g(r);)if(++h,h===u.length)return t(n),!1;return!!a(r)||0!==ie(r,u[h][1])&&0!==ie(r,u[h][0])&&(t(function(){f===fe?e.continue(u[h][0]):e.continue(u[h][1])}),!1)}),p},startsWithAnyOf:function(){var n=U.apply(Le,arguments);return n.every(function(e){return"string"==typeof e})?0===n.length?t(this):this.inAnyRange(n.map(function(e){return[e,e+ft]})):e(this,"startsWithAnyOf() only works with strings")}}}),g(Y.prototype,function(){function e(e,t){e.filter=Ce(e.filter,t)}function t(e,t,n){var r=e.replayFilter;e.replayFilter=r?function(){return Ce(r(),t())}:t,e.justLimit=n&&!r}function n(e,t){e.isMatch=Ce(e.isMatch,t)}function r(e,t){if(e.isPrimKey)return t;var n=e.table.schema.idxByName[e.index];if(!n)throw new Qe.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return t.index(n.name)}function o(e,t){var n=r(e,t);return e.keysOnly&&"openKeyCursor"in n?n.openKeyCursor(e.range||null,e.dir+e.unique):n.openCursor(e.range||null,e.dir+e.unique)}function a(e,t,n,r,i){var a=e.replayFilter?Ce(e.filter,e.replayFilter()):e.filter;e.or?function(){function s(){2===++l&&n()}function u(e,n,o){if(!a||a(n,o,s,r)){var i=n.primaryKey.toString();m(c,i)||(c[i]=!0,t(e,n,o))}}var c={},l=0;e.or._iterate(u,s,r,i),re(o(e,i),e.algorithm,u,s,r,!e.keysOnly&&e.valueMapper)}():re(o(e,i),Ce(e.algorithm,a),t,n,r,!e.keysOnly&&e.valueMapper)}function s(e){return e.table.schema.instanceTemplate}return{_read:function(e,t){var n=this._ctx;return n.error?n.table._trans(null,function(e,t){t(n.error)}):n.table._idbstore(Ze,e).then(t)},_write:function(e){var t=this._ctx;return t.error?t.table._trans(null,function(e,n){n(t.error)}):t.table._idbstore(et,e,"locked")},_addAlgorithm:function(e){var t=this._ctx;t.algorithm=Ce(t.algorithm,e)},_iterate:function(e,t,n,r){return a(this._ctx,e,t,n,r)},clone:function(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&d(n,e),t._ctx=n,t},raw:function(){return this._ctx.valueMapper=null,this},each:function(e){var t=this._ctx;if(wt){var n=s(t),r=t.table.schema.primKey.keyPath,o=M(n,t.index?t.table.schema.idxByName[t.index].keyPath:r),i=M(n,r);e(n,{key:o,primaryKey:i})}return this._read(function(n,r,o){a(t,e,n,r,o)})},count:function(e){if(wt)return G.resolve(0).then(e);var t=this._ctx;if(X(t,!0))return this._read(function(e,n,o){var i=r(t,o),a=t.range?i.count(t.range):i.count();a.onerror=ge(n),a.onsuccess=function(n){e(Math.min(n.target.result,t.limit))}},e);var n=0;return this._read(function(e,r,o){a(t,function(){return++n,!1},function(){e(n)},r,o)},e)},sortBy:function(e,t){function n(e,t){return t?n(e[o[t]],t-1):e[i]}function r(e,t){var r=n(e,a),o=n(t,a);return r<o?-s:r>o?s:0}var o=e.split(".").reverse(),i=o[0],a=o.length-1,s="next"===this._ctx.dir?1:-1;return this.toArray(function(e){return e.sort(r)}).then(t)},toArray:function(e){var t=this._ctx;return this._read(function(e,n,o){if(wt&&e([s(t)]),Pe&&"next"===t.dir&&X(t,!0)&&t.limit>0){var u=t.table.hook.reading.fire,c=r(t,o),l=t.limit<1/0?c.getAll(t.range,t.limit):c.getAll(t.range);l.onerror=ge(n),l.onsuccess=u===i?de(e):ae(de(function(t){e(t.map(u))}))}else{var f=[];a(t,function(e){f.push(e)},function(){e(f)},n,o)}},e)},offset:function(e){var n=this._ctx;return e<=0?this:(n.offset+=e,X(n)?t(n,function(){var t=e;return function(e,n){return 0===t||(1===t?(--t,!1):(n(function(){e.advance(t),t=0}),!1))}}):t(n,function(){var t=e;return function(){return--t<0}}),this)},limit:function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),t(this._ctx,function(){var t=e;return function(e,n,r){return--t<=0&&n(r),t>=0}},!0),this},until:function(t,n){var r=this._ctx;return wt&&t(s(r)),e(this._ctx,function(e,r,o){return!t(e.value)||(r(o),n)}),this},first:function(e){return this.limit(1).toArray(function(e){return e[0]}).then(e)},last:function(e){return this.reverse().first(e)},filter:function(t){return wt&&t(s(this._ctx)),e(this._ctx,function(e){return t(e.value)}),n(this._ctx,t),this},and:function(e){return this.filter(e)},or:function(e){return new $(this._ctx.table,e,this)},reverse:function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},desc:function(){return this.reverse()},eachKey:function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(t,n){e(n.key,n)})},eachUniqueKey:function(e){return this._ctx.unique="unique",this.eachKey(e)},eachPrimaryKey:function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(t,n){e(n.primaryKey,n)})},keys:function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each(function(e,t){n.push(t.key)}).then(function(){return n}).then(e)},primaryKeys:function(e){var t=this._ctx;if(Pe&&"next"===t.dir&&X(t,!0)&&t.limit>0)return this._read(function(e,n,o){var i=r(t,o),a=t.limit<1/0?i.getAllKeys(t.range,t.limit):i.getAllKeys(t.range);a.onerror=ge(n),a.onsuccess=de(e)}).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each(function(e,t){n.push(t.primaryKey)}).then(function(){return n}).then(e)},uniqueKeys:function(e){return this._ctx.unique="unique",this.keys(e)},firstKey:function(e){return this.limit(1).keys(function(e){return e[0]}).then(e)},lastKey:function(e){return this.reverse().firstKey(e)},distinct:function(){var t=this._ctx,n=t.index&&t.table.schema.idxByName[t.index];if(!n||!n.multi)return this;var r={};return e(this._ctx,function(e){var t=e.primaryKey.toString(),n=m(r,t);return r[t]=!0,!n}),this}}}),v(Z).from(Y).extend({modify:function(e){var t=this,n=this._ctx,r=n.table.hook,i=r.updating.fire,a=r.deleting.fire;return wt&&"function"==typeof e&&e.call({value:n.table.schema.instanceTemplate},n.table.schema.instanceTemplate),this._write(function(n,r,s,u){function c(e,t){function n(e){return w.push(e),x.push(r.primKey),f(),!0}T=t.primaryKey;var r={primKey:t.primaryKey,value:e,onsuccess:null,onerror:null};if(h.call(r,e,r)!==!1){var o=!m(r,"value");++y,S(function(){var e=o?t.delete():t.update(r.value);e._hookCtx=r,e.onerror=pe(n),e.onsuccess=me(function(){++b,f()})},n)}else r.onsuccess&&r.onsuccess(r.value)}function l(e){return e&&(w.push(e),x.push(T)),r(new F("Error modifying one or more objects",w,b,x))}function f(){k&&b+w.length===y&&(w.length>0?l():n(b))}var h;if("function"==typeof e)h=i===o&&a===o?e:function(t){var n=B(t);if(e.call(this,t,this)===!1)return!1;if(m(this,"value")){var r=j(n,this.value),o=i.call(this,r,this.primKey,n,u);o&&(t=this.value,Ae(o).forEach(function(e){D(t,e,o[e])}))}else a.call(this,this.primKey,t,u)};else if(i===o){var g=Ae(e),p=g.length;h=function(t){for(var n=!1,r=0;r<p;++r){var o=g[r],i=e[o];M(t,o)!==i&&(D(t,o,i),n=!0)}return n}}else{var v=e;e=E(v),h=function(t){var n=!1,r=i.call(this,e,this.primKey,B(t),u);return r&&d(e,r),Ae(e).forEach(function(r){var o=e[r];M(t,r)!==o&&(D(t,r,o),n=!0)}),r&&(e=E(v)),n}}var y=0,b=0,k=!1,w=[],x=[],T=null;t.clone().raw()._iterate(c,function(){k=!0,f()},l,s)})},delete:function(){var e=this,t=this._ctx,n=t.range,r=t.table.hook.deleting.fire,i=r!==o;if(!i&&X(t)&&(t.isPrimKey&&!yt||!n))return this._write(function(e,t,r){var o=ge(t),i=n?r.count(n):r.count();i.onerror=o,i.onsuccess=function(){var a=i.result;S(function(){var t=n?r.delete(n):r.clear();t.onerror=o,t.onsuccess=function(){return e(a)}},function(e){return t(e)})}});var a=i?2e3:1e4;return this._write(function(n,o,s,u){var c=0,l=e.clone({keysOnly:!t.isMatch&&!i}).distinct().limit(a).raw(),f=[],h=function(){return l.each(i?function(e,t){f.push([t.primaryKey,t.value])}:function(e,t){f.push(t.primaryKey)}).then(function(){return i?f.sort(function(e,t){return fe(e[0],t[0])}):f.sort(fe),J(s,u,f,i,r)}).then(function(){var e=f.length;return c+=e,f=[],e<a?c:h()})};n(h())})}}),d(this,{Collection:Y,Table:V,Transaction:H,Version:s,WhereClause:$,WriteableCollection:Z,WriteableTable:W}),r(),Ke.forEach(function(e){e(tt)})}function fe(e){if("function"==typeof e)return new e;if(Me(e))return[fe(e[0])];if(e&&"object"==typeof e){var t={};return he(t,e),t}return e}function he(e,t){return Ae(t).forEach(function(n){var r=fe(t[n]);e[n]=r}),e}function de(e){return function(t){e(t.target.result)}}function me(e){return ae(function(t){var n=t.target,r=n.result,o=n._hookCtx,i=o&&o.onsuccess;i&&i(r),e&&e(r)},e)}function ge(e){return function(t){return ve(t),e(t.target.error),!1}}function pe(e){return ae(function(t){var n=t.target,r=n.error,o=n._hookCtx,i=o&&o.onerror;return i&&i(r),ve(t),e(r),!1})}function ve(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}function ye(e){var t,n=le.dependencies.localStorage;if(!n)return e([]);try{t=JSON.parse(n.getItem("Dexie.DatabaseNames")||"[]")}catch(e){t=[]}e(t)&&n.setItem("Dexie.DatabaseNames",JSON.stringify(t))}function be(e){function t(e){return function(t){var n=e(t),r=n.value;return n.done?r:r&&"function"==typeof r.then?r.then(o,i):Me(r)?G.all(r).then(o,i):o(r)}}var n=function(t){return e.next(t)},r=function(t){return e.throw(t)},o=t(n),i=t(r);return t(n)()}function ke(e,t,n,r,o,i,a){this.name=e,this.keyPath=t,this.unique=n,this.multi=r,this.auto=o,this.compound=i,this.dotted=a;var s="string"==typeof t?t:t&&"["+[].join.call(t,"+")+"]";this.src=(n?"&":"")+(r?"*":"")+(o?"++":"")+s}function we(e,t,n,r){this.name=e,this.primKey=t||new ke,this.indexes=n||[new ke],this.instanceTemplate=r,this.mappedClass=null,this.idxByName=I(n,function(e){return[e.name,e]})}function xe(e){return 1===e.length?e[0]:e}function Te(e){var t=e&&(e.getDatabaseNames||e.webkitGetDatabaseNames);return t&&t.bind(e)}var Ie="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href),_e=function(){return!0},Se=!new Error("").stack,Ae=Object.keys,Me=Array.isArray,De="undefined"!=typeof self?self:"undefined"!=typeof window?window:e,Ce=Object.getPrototypeOf,Ee={}.hasOwnProperty,Be=Object.getOwnPropertyDescriptor,je=[].slice,Ue="undefined"!=typeof Symbol&&Symbol.iterator,Oe=Ue?function(e){var t;return null!=e&&(t=e[Ue])&&t.apply(e)}:function(){return null},Le={},Pe=[].concat,Fe=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","IncompatiblePromise"],qe=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Ke=Fe.concat(qe),Ne={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed"};v(L).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+r(this._e,2))}},toString:function(){return this.name+": "+this.message}}),v(F).from(L),v(q).from(L);var Ge=Ke.reduce(function(e,t){return e[t]=t+"Error",e},{}),Re=L,Qe=Ke.reduce(function(e,t){function r(e,r){this._e=n(),this.name=o,e?"string"==typeof e?(this.message=e,this.inner=r||null):"object"==typeof e&&(this.message=e.name+" "+e.message,this.inner=e):(this.message=Ne[t]||o,this.inner=null)}var o=t+"Error";return v(r).from(Re),e[t]=r,e},{});Qe.Syntax=SyntaxError,Qe.Type=TypeError,Qe.Range=RangeError;var Ve=qe.reduce(function(e,t){return e[t+"Error"]=Qe[t],e},{}),We=Ke.reduce(function(e,t){return["Syntax","Type","Range"].indexOf(t)===-1&&(e[t+"Error"]=Qe[t]),e},{});We.ModifyError=F,We.DexieError=L,We.BulkError=q;var ze={},Je=100,He=20,$e=!1,Ye="undefined"==typeof setImmediate?function(){setTimeout(Y,0)}:setImmediate.bind(null,Y),Xe=function(e,t){st.push([e,t]),et&&(Ye(),et=!1)},Ze=!0,et=!0,tt=[],nt=[],rt=null,ot=i,it={global:!0,ref:0,unhandleds:[],onunhandled:ce,finalize:function(){this.unhandleds.forEach(function(e){try{ce(e[0],e[1])}catch(e){}})}},at=it,st=[],ut=0,ct=[];g(G.prototype,{then:function(e,t){var n=this,r=new G(function(r,o){z(n,new R(e,t,r,o))});return Ie&&(!this._prev||null===this._state)&&$(r,this),r},_then:function(e,t){z(this,new R(null,null,e,t))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],n=arguments[1];return"function"==typeof t?this.then(null,function(e){return e instanceof t?n(e):ie(e)}):this.then(null,function(e){return e&&e.name===t?n(e):ie(e)})},finally:function(e){return this.then(function(t){return e(),t},function(t){return e(),ie(t)})},uncaught:function(e){var t=this;return this.onuncatched=f(this.onuncatched,e),this._state===!1&&tt.indexOf(this)===-1&&tt.some(function(e,n,r){return e._value===t._value&&(r[n]=t)}),this},stack:{get:function(){if(this._stack)return this._stack;try{$e=!0;var e=H(this,[],He),t=e.join("\nFrom previous: ");return null!==this._state&&(this._stack=t),t}finally{$e=!1}}}}),g(G,{all:function(){var e=U.apply(null,arguments);return new G(function(t,n){0===e.length&&t([]);var r=e.length;e.forEach(function(o,i){return G.resolve(o).then(function(n){e[i]=n,--r||t(e)},n)})})},resolve:function(e){return e&&"function"==typeof e.then?e:new G(ze,(!0),e)},reject:ie,race:function(){var e=U.apply(null,arguments);return new G(function(t,n){e.map(function(e){return G.resolve(e).then(t,n)})})},PSD:{get:function(){return at},set:function(e){return at=e}},newPSD:se,usePSD:ue,scheduler:{get:function(){return Xe},set:function(e){Xe=e}},rejectionMapper:{get:function(){return ot},set:function(e){ot=e}},follow:function(e){return new G(function(t,n){return se(function(t,n){var r=at;r.unhandleds=[],r.onunhandled=n,r.finalize=s(function(){var e=this;te(function(){0===e.unhandleds.length?t():n(e.unhandleds[0])})},r.finalize),e()},t,n)})},on:N(null,{error:[f,oe]})}),w(function(){Xe=function(e,t){setTimeout(function(){e.apply(null,t)},0)}});var lt="1.4.1",ft=String.fromCharCode(65535),ht=function(){try{return IDBKeyRange.only([[]]),[[]]}catch(e){return ft}}(),dt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",mt="String expected.",gt=[],pt="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),vt=pt,yt=pt,bt=function(e){return!/(dexie\.js|dexie\.min\.js)/.test(e)};t(Ie,bt);var kt=function(){},wt=!1,xt=De.idbModules&&De.idbModules.shimIndexedDB?De.idbModules:{};return g(le,We),g(le,{delete:function(e){var t=new le(e),n=t.delete();return n.onblocked=function(e){return t.on("blocked",e),this},n},exists:function(e){return new le(e).open().then(function(e){return e.close(),!0}).catch(le.NoSuchDatabaseError,function(){return!1})},getDatabaseNames:function(e){return new G(function(e,t){var n=Te(indexedDB);if(n){var r=n();r.onsuccess=function(t){e(b(t.target.result,0))},r.onerror=ge(t)}else ye(function(t){return e(t),!1})}).then(e)},defineClass:function(e){function t(t){t?d(this,t):wt&&he(this,e)}return t},applyStructure:he,ignoreTransaction:function(e){return at.trans?ue(at.transless,e):e()},vip:function(e){return se(function(){return at.letThrough=!0,e()})},async:function(e){return function(){try{var t=be(e.apply(this,arguments));return t&&"function"==typeof t.then?t:G.resolve(t)}catch(e){return A(e)}}},spawn:function(e,t,n){try{var r=be(e.apply(n,t||[]));return r&&"function"==typeof r.then?r:G.resolve(r)}catch(e){return A(e)}},currentTransaction:{get:function(){return at.trans||null}},Promise:G,debug:{get:function(){return Ie},set:function(e){t(e,"dexie"===e?function(){return!0}:bt)}},derive:v,extend:d,props:g,override:k,Events:N,events:N,getByKeyPath:M,setByKeyPath:D,delByKeyPath:C,shallowClone:E,deepClone:B,getObjectDiff:j,asap:T,maxKey:ht,addons:[],connections:gt,MultiModifyError:Qe.Modify,errnames:Ge,IndexSpec:ke,TableSchema:we,dependencies:{indexedDB:xt.shimIndexedDB||De.indexedDB||De.mozIndexedDB||De.webkitIndexedDB||De.msIndexedDB,IDBKeyRange:xt.IDBKeyRange||De.IDBKeyRange||De.webkitIDBKeyRange},semVer:lt,version:lt.split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,n){return e+t/Math.pow(10,2*n)}),fakeAutoComplete:kt,default:le}),S(function(){le.dependencies.localStorage=null!=("undefined"!=typeof chrome&&null!==chrome?chrome.storage:void 0)?null:De.localStorage}),G.rejectionMapper=K,w(function(){le.fakeAutoComplete=kt=w,le.fake=wt=!0}),le})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],11:[function(e,t,n){function r(e){this.message=e}function o(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new r("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,o,a=0,s=0,u="";o=t.charAt(s++);~o&&(n=a%4?64*n+o:o,a++%4)?u+=String.fromCharCode(255&n>>(-2*a&6)):0)o=i.indexOf(o);return u}var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.prototype=new Error,r.prototype.name="InvalidCharacterError",t.exports="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||o},{}],12:[function(e,t,n){function r(e){return decodeURIComponent(o(e).replace(/(.)/g,function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}))}var o=e("./atob");t.exports=function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return r(t)}catch(e){return o(t)}}},{"./atob":11}],13:[function(e,t,n){"use strict";var r=e("./base64_url_decode");t.exports=function(e,t){if("string"!=typeof e)throw new Error("Invalid token specified");t=t||{};var n=t.header===!0?0:1;return JSON.parse(r(e.split(".")[n]))}},{"./base64_url_decode":12}]},{},[1]);